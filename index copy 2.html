 vc[ <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <meta name="description" content="ClockWork - Universal Business Platform for Service Professionals">
    <meta name="keywords" content="business management, client management, fitness platform, service business, personal trainer">
    <meta name="author" content="ClockWork Platform">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://clockwork.platform/">
    <meta property="og:title" content="ClockWork - Universal Business Platform">
    <meta property="og:description" content="Transform your service business with our all-in-one management platform">
    <meta property="og:image" content="https://clockwork.platform/og-image.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://clockwork.platform/">
    <meta property="twitter:title" content="ClockWork - Universal Business Platform">
    <meta property="twitter:description" content="Transform your service business with our all-in-one management platform">
    <meta property="twitter:image" content="https://clockwork.platform/twitter-image.png">
    
    <title>ClockWork - Universal Business Platform</title>
    
    <!-- PWA Support -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">
    
    <!-- External Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Print Styles -->
    <style type="text/css" media="print">
        @page { margin: 0.5in; }
        .no-print { display: none !important; }
        body { background: white !important; color: black !important; }
    </style>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        :root {
            /* ClockWork dark theme colors */
            --clockwork-primary: #3b82f6;
            --clockwork-secondary: #60a5fa;
            --clockwork-accent: #fbbf24;
            --clockwork-dark: #0f172a;
            --clockwork-darker: #020617;
            --clockwork-light: #1e293b;
            --clockwork-gray: #64748b;
            --clockwork-text: #e2e8f0;
            --clockwork-success: #10b981;
            --clockwork-error: #ef4444;
            
            /* Keep these for chat functionality */
            --fb-blue: #0084ff;
            --fb-gray: #1e293b;
        }
        
        * {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: var(--clockwork-darker);
            color: var(--clockwork-text);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Responsive Base Styles */
        .container {
            width: 100%;
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        @media (min-width: 640px) {
            .container { padding: 0 1.5rem; }
        }
        
        @media (min-width: 1024px) {
            .container { padding: 0 2rem; }
        }
        
        /* Mobile Navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--clockwork-light);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 40;
            padding: 0.5rem 0;
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.3);
        }
        
        @media (max-width: 768px) {
            .mobile-nav {
                display: flex;
                justify-content: space-around;
                align-items: center;
            }
            
            .desktop-nav {
                display: none !important;
            }
            
            .main-content {
                padding-bottom: 4rem;
            }
        }
        
        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem;
            color: var(--clockwork-gray);
            font-size: 0.75rem;
            transition: color 0.2s;
            cursor: pointer;
            border: none;
            background: none;
            min-width: 60px;
        }
        
        .mobile-nav-item.active {
            color: var(--clockwork-primary);
        }
        
        .mobile-nav-item i {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }
        
        /* Enhanced Responsive Utilities */
        .responsive-grid {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
        
        @media (min-width: 640px) {
            .responsive-grid { gap: 1.5rem; }
        }
        
        @media (min-width: 1024px) {
            .responsive-grid { gap: 2rem; }
        }
        
        /* App Container */
        .app-container {
            background-color: var(--clockwork-darker);
            min-height: 100vh;
            color: var(--clockwork-text);
        }
        
        .clockwork-gradient {
            background: linear-gradient(135deg, var(--clockwork-dark) 0%, var(--clockwork-primary) 100%);
            min-height: 100vh;
            position: relative;
        }
        
        /* Card Styles */
        .login-card {
            background: var(--clockwork-light);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 440px;
            margin: 0 auto;
        }
        
        @media (min-width: 640px) {
            .login-card { padding: 3rem; }
        }
        
        .clockwork-card {
            background: var(--clockwork-light);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .clockwork-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.2);
        }
        
        /* Button Styles */
        .clockwork-button {
            background: var(--clockwork-primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            white-space: nowrap;
        }
        
        .clockwork-button.login {
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1.1rem;
            width: 100%;
        }
        
        .clockwork-button:hover:not(:disabled) {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .clockwork-button:disabled {
            background: #475569;
            cursor: not-allowed;
            transform: none;
            opacity: 0.7;
        }
        
        .clockwork-button-secondary {
            background: var(--clockwork-accent);
            color: var(--clockwork-dark);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .clockwork-button-secondary:hover {
            background: #f59e0b;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
        }
        
        .clockwork-button-success {
            background: var(--clockwork-success);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .clockwork-button-success:hover {
            background: #059669;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        
        .clockwork-button-danger {
            background: var(--clockwork-error);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .clockwork-button-danger:hover {
            background: #dc2626;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }
        
        /* Input Styles */
        .clockwork-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--clockwork-darker);
            color: var(--clockwork-text);
        }
        
        @media (min-width: 640px) {
            .clockwork-input { padding: 1rem; }
        }
        
        .clockwork-input:focus {
            outline: none;
            border-color: var(--clockwork-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .clockwork-input.error {
            border-color: var(--clockwork-error);
        }
        
        .clockwork-select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--clockwork-darker);
            color: var(--clockwork-text);
            cursor: pointer;
        }
        
        /* Badge Styles */
        .clockwork-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-client { background: rgba(219, 234, 254, 0.2); color: #93bbfc; }
        .badge-specialist { background: rgba(209, 250, 229, 0.2); color: #6ee7b7; }
        .badge-admin { background: rgba(254, 243, 199, 0.2); color: #fcd34d; }
        .badge-owner { background: rgba(233, 213, 255, 0.2); color: #c4b5fd; }
        .badge-engineer { background: rgba(254, 226, 226, 0.2); color: #fca5a5; }
        
        /* Tab Styles */
        .clockwork-tab {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            background: transparent;
            color: var(--clockwork-text);
            font-size: 0.875rem;
        }
        
        @media (min-width: 640px) {
            .clockwork-tab {
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
            }
        }
        
        .clockwork-tab:hover {
            background: rgba(251, 191, 36, 0.1);
        }
        
        .clockwork-tab.active {
            background: var(--clockwork-primary);
            color: white;
        }
        
        /* Typography */
        .text-xxs {
            font-size: 0.65rem;
            line-height: 1rem;
        }
        
        /* Logo Styles */
        .clockwork-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            justify-content: center;
            margin-bottom: 1.5rem;
        }
        
        @media (min-width: 640px) {
            .clockwork-logo { gap: 1rem; }
        }
        
        .clockwork-logo.small {
            justify-content: flex-start;
            margin-bottom: 0;
            gap: 0.75rem;
        }
        
        .clockwork-logo.small .logo-icon {
            width: 32px;
            height: 32px;
        }
        
        @media (min-width: 640px) {
            .clockwork-logo.small .logo-icon {
                width: 40px;
                height: 40px;
            }
        }
        
        .logo-icon {
            width: 60px;
            height: 60px;
            position: relative;
            background: var(--clockwork-dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4), 0 0 20px rgba(59, 130, 246, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        @media (min-width: 640px) {
            .logo-icon {
                width: 80px;
                height: 80px;
            }
        }
        
        .logo-icon::before {
            content: '🌍';
            font-size: 2rem;
            position: absolute;
        }
        
        @media (min-width: 640px) {
            .logo-icon::before { font-size: 2.5rem; }
        }
        
        .logo-icon::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px solid var(--clockwork-accent);
            border-radius: 50%;
            border-top-color: transparent;
            border-right-color: transparent;
            animation: spin 3s linear infinite;
        }
        
        .clockwork-logo.small .logo-icon::before {
            font-size: 1.25rem;
        }
        
        @media (min-width: 640px) {
            .clockwork-logo.small .logo-icon::before {
                font-size: 1.5rem;
            }
        }
        
        .clockwork-logo.small .logo-icon::after {
            border-width: 2px;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .logo-text-primary {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            letter-spacing: 0.05em;
            color: var(--clockwork-text);
            font-size: 1.5rem;
        }
        
        @media (min-width: 640px) {
            .logo-text-primary { font-size: 1.875rem; }
        }
        
        .clockwork-logo.small .logo-text-primary {
            font-size: 1rem;
        }
        
        @media (min-width: 640px) {
            .clockwork-logo.small .logo-text-primary {
                font-size: 1.125rem;
            }
        }
        
        .logo-text-secondary {
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--clockwork-gray);
            font-size: 0.625rem;
        }
        
        @media (min-width: 640px) {
            .logo-text-secondary { font-size: 0.75rem; }
        }
        
        /* Form Styles */
        .login-toggle {
            display: flex;
            margin-bottom: 2rem;
            border-radius: 12px;
            overflow: hidden;
            background: var(--clockwork-darker);
            padding: 4px;
        }
        
        .login-toggle button {
            flex: 1;
            padding: 0.875rem;
            border: none;
            background: transparent;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border-radius: 8px;
            color: var(--clockwork-text);
        }
        
        .login-toggle button.active {
            background: var(--clockwork-primary);
            color: white;
        }
        
        .login-toggle button:not(.active) {
            color: var(--clockwork-gray);
        }
        
        .brand-tagline {
            color: var(--clockwork-gray);
            margin-bottom: 2rem;
            font-size: 1rem;
            text-align: center;
        }
        
        @media (min-width: 640px) {
            .brand-tagline { font-size: 1.1rem; }
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: var(--clockwork-text);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        @media (min-width: 640px) {
            .form-label { font-size: 0.95rem; }
        }
        
        /* Progress Bar */
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 9999px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--clockwork-primary) 0%, var(--clockwork-accent) 100%);
            transition: width 0.5s ease;
            border-radius: 9999px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Stat Card */
        .stat-card {
            background: var(--clockwork-light);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--clockwork-primary) 0%, var(--clockwork-accent) 100%);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        /* Loading Spinner */
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-top: 2px solid var(--clockwork-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-content {
            text-align: center;
            color: white;
        }
        
        .loading-content .loading-spinner {
            width: 40px;
            height: 40px;
            margin: 0 auto 1rem;
        }
        
        /* Message Styles */
        .error-message {
            background: rgba(254, 226, 226, 0.1);
            color: #fca5a5;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid rgba(252, 165, 165, 0.3);
            margin: 0.5rem 0;
            font-size: 0.875rem;
        }
        
        .success-message {
            background: rgba(209, 250, 229, 0.1);
            color: #6ee7b7;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid rgba(110, 231, 183, 0.3);
            margin: 0.5rem 0;
            font-size: 0.875rem;
        }
        
        .info-message {
            background: rgba(219, 234, 254, 0.1);
            color: #93bbfc;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid rgba(147, 187, 252, 0.3);
            margin: 0.5rem 0;
            font-size: 0.875rem;
        }
        
        /* Chat Styles - Enhanced for Mobile */
        .chat-container {
            display: flex;
            height: 500px;
            background: var(--clockwork-light);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        @media (min-width: 768px) {
            .chat-container { height: 600px; }
        }
        
        @media (max-width: 767px) {
            .chat-container {
                flex-direction: column;
                height: calc(100vh - 200px);
            }
        }
        
        .chat-sidebar {
            width: 100%;
            background: var(--clockwork-light);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
        }
        
        @media (min-width: 768px) {
            .chat-sidebar {
                width: 320px;
            }
        }
        
        @media (max-width: 767px) {
            .chat-sidebar {
                height: 200px;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .chat-sidebar.hidden-mobile {
                display: none;
            }
        }
        
        .chat-header {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: var(--clockwork-light);
        }
        
        .chat-search {
            padding: 0.5rem 1rem;
            background: var(--clockwork-darker);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            width: 100%;
            font-size: 0.875rem;
            color: var(--clockwork-text);
        }
        
        .chat-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .chat-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }
        
        .chat-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .chat-item.active {
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid var(--clockwork-primary);
        }
        
        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--clockwork-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 0.75rem;
            position: relative;
            flex-shrink: 0;
            font-size: 0.875rem;
        }
        
        @media (min-width: 640px) {
            .chat-avatar {
                width: 50px;
                height: 50px;
                font-size: 1rem;
            }
        }
        
        .online-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 10px;
            height: 10px;
            background: #44b700;
            border-radius: 50%;
            border: 2px solid var(--clockwork-light);
        }
        
        @media (min-width: 640px) {
            .online-indicator {
                width: 12px;
                height: 12px;
            }
        }
        
        .chat-item-info {
            flex: 1;
            min-width: 0;
        }
        
        .chat-item-name {
            font-weight: 500;
            margin-bottom: 0.125rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--clockwork-text);
            font-size: 0.875rem;
        }
        
        @media (min-width: 640px) {
            .chat-item-name { font-size: 1rem; }
        }
        
        .chat-item-message {
            font-size: 0.75rem;
            color: var(--clockwork-gray);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        @media (min-width: 640px) {
            .chat-item-message { font-size: 0.875rem; }
        }
        
        .chat-item-time {
            font-size: 0.75rem;
            color: var(--clockwork-gray);
            position: absolute;
            top: 0.75rem;
            right: 1rem;
        }
        
        .unread-count {
            position: absolute;
            bottom: 0.75rem;
            right: 1rem;
            background: var(--fb-blue);
            color: white;
            font-size: 0.75rem;
            padding: 0.125rem 0.375rem;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }
        
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .chat-main-header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--clockwork-light);
        }
        
        @media (min-width: 640px) {
            .chat-main-header { padding: 1rem; }
        }
        
        @media (max-width: 767px) {
            .chat-main-header {
                position: sticky;
                top: 0;
                z-index: 10;
            }
            
            .back-to-chats {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                color: var(--clockwork-primary);
                font-size: 0.875rem;
                cursor: pointer;
                background: none;
                border: none;
                padding: 0.5rem;
                margin-right: 0.5rem;
            }
        }
        
        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: var(--clockwork-darker);
        }
        
        .message-group {
            margin-bottom: 1rem;
        }
        
        .message-bubble {
            max-width: 70%;
            padding: 0.5rem 1rem;
            border-radius: 18px;
            margin-bottom: 0.125rem;
            word-wrap: break-word;
            white-space: pre-wrap;
            font-size: 0.875rem;
        }
        
        @media (min-width: 640px) {
            .message-bubble { font-size: 1rem; }
        }
        
        .message-bubble.zoom-meeting {
            background: linear-gradient(45deg, #2D8CFF, #0B5CFF) !important;
            color: white !important;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(11, 92, 255, 0.3);
        }
        
        .message-sent {
            background: var(--fb-blue);
            color: white;
            margin-left: auto;
        }
        
        .message-received {
            background: rgba(255, 255, 255, 0.1);
            color: var(--clockwork-text);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .message-time {
            font-size: 0.75rem;
            color: var(--clockwork-gray);
            margin: 0.25rem 0.5rem;
        }
        
        .message-sent + .message-time {
            text-align: right;
        }
        
        .chat-input-container {
            padding: 0.75rem;
            background: var(--clockwork-light);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        @media (min-width: 640px) {
            .chat-input-container { padding: 1rem; }
        }
        
        .chat-input {
            flex: 1;
            padding: 0.5rem 1rem;
            background: var(--clockwork-darker);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 0.875rem;
            outline: none;
            resize: none;
            min-height: 36px;
            max-height: 100px;
            line-height: 1.4;
            color: var(--clockwork-text);
        }
        
        .chat-send-btn {
            background: var(--fb-blue);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s;
            flex-shrink: 0;
        }
        
        .chat-send-btn:hover:not(:disabled) {
            transform: scale(1.1);
        }
        
        .chat-send-btn:disabled {
            background: #475569;
            cursor: not-allowed;
            transform: none;
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 18px;
            width: fit-content;
            margin-bottom: 0.5rem;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--clockwork-gray);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 80%, 100% {
                opacity: 0;
                transform: scale(0.8);
            }
            40% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* Pain and Mood Buttons */
        .pain-scale-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        @media (min-width: 640px) {
            .pain-scale-btn {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
        }
        
        .pain-scale-btn:hover {
            transform: scale(1.1);
        }
        
        .pain-scale-btn.selected {
            border-color: var(--clockwork-primary);
            transform: scale(1.15);
        }
        
        .pain-0 { background: rgba(209, 250, 229, 0.3); color: #6ee7b7; }
        .pain-1 { background: rgba(254, 243, 199, 0.3); color: #fcd34d; }
        .pain-2 { background: rgba(254, 215, 170, 0.3); color: #fdba74; }
        .pain-3 { background: rgba(254, 202, 202, 0.3); color: #fca5a5; }
        .pain-4 { background: rgba(248, 113, 113, 0.3); color: #f87171; }
        .pain-5 { background: rgba(220, 38, 38, 0.3); color: #dc2626; }
        
        .mood-btn {
            font-size: 1.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0.5rem;
            border-radius: 8px;
            border: 2px solid transparent;
        }
        
        @media (min-width: 640px) {
            .mood-btn { font-size: 2rem; }
        }
        
        .mood-btn:hover {
            transform: scale(1.2);
        }
        
        .mood-btn.selected {
            border-color: var(--clockwork-primary);
            background: rgba(59, 130, 246, 0.1);
        }
        
        /* Exercise Card */
        .exercise-card {
            background: var(--clockwork-darker);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
        }
        
        /* Zoom Button */
        .zoom-btn {
            background: linear-gradient(45deg, #2D8CFF, #0B5CFF);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        @media (min-width: 640px) {
            .zoom-btn { font-size: 1rem; }
        }
        
        .zoom-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(11, 92, 255, 0.4);
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding: 1rem;
            backdrop-filter: blur(4px);
            overflow-y: auto;
        }
        
        .modal-content {
            background: var(--clockwork-light);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @media (min-width: 640px) {
            .modal-content { padding: 2rem; }
        }
        
        .modal-content.max-w-lg {
            max-width: 32rem;
        }
        
        .modal-content.max-w-2xl {
            max-width: 42rem;
        }
        
        .modal-content.max-w-4xl {
            max-width: 56rem;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        /* Assignment Form */
        .assignment-form {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(251, 191, 36, 0.1) 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        @media (min-width: 640px) {
            .assignment-form { padding: 2rem; }
        }
        
        .assignment-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--clockwork-primary);
        }
        
        @media (min-width: 640px) {
            .assignment-header { font-size: 1.25rem; }
        }
        
        .specialist-note {
            background: rgba(251, 191, 36, 0.1);
            border-left: 4px solid var(--clockwork-accent);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
            color: var(--clockwork-text);
        }
        
        /* Animation */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        /* Summary Cards */
        .mood-summary-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.2) 100%);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .pain-summary-card {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(251, 191, 36, 0.2) 100%);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }
        
        /* Image Upload */
        .workout-image-upload {
            position: relative;
            width: 120px;
            height: 120px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 1rem 0;
            background: var(--clockwork-darker);
        }
        
        @media (min-width: 640px) {
            .workout-image-upload {
                width: 150px;
                height: 150px;
            }
        }
        
        .workout-image-upload:hover {
            border-color: var(--clockwork-primary);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .workout-image-upload input[type="file"] {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .workout-image-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }
        
        /* Measurement Grid */
        .measurement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        @media (min-width: 640px) {
            .measurement-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }
        
        .measurement-input-group {
            display: flex;
            flex-direction: column;
        }
        
        .measurement-input-group label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--clockwork-text);
            margin-bottom: 0.25rem;
        }
        
        .measurement-input-group input {
            padding: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            font-size: 0.875rem;
            background: var(--clockwork-darker);
            color: var(--clockwork-text);
        }
        
        .measurement-category {
            background: var(--clockwork-darker);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .measurement-category h4 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--clockwork-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .bmr-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 1rem;
            font-size: 0.875rem;
            font-weight: 400;
        }
        
        .bmr-toggle input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
            cursor: pointer;
        }
        
        /* Billing Styles */
        .billing-card {
            background: var(--clockwork-light);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .invoice-status {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .invoice-status.paid {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .invoice-status.pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }
        
        .invoice-status.overdue {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .price-input-group {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .price-input-group span {
            position: absolute;
            left: 1rem;
            color: var(--clockwork-gray);
            font-weight: 600;
        }
        
        .price-input-group input {
            padding-left: 2rem;
        }
        
        /* Training Schedule Styles */
        .training-slot {
            background: var(--clockwork-darker);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .training-slot:hover {
            border-color: var(--clockwork-primary);
            transform: translateY(-2px);
        }
        
        .training-slot.selected {
            border-color: var(--clockwork-primary);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .training-slot.booked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Reports Styles */
        .report-card {
            background: var(--clockwork-light);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .report-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        .report-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        /* Users Table */
        .users-table {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .users-table table {
            width: 100%;
            min-width: 600px;
        }
        
        /* Engineer Console */
        .engineer-console {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            white-space: pre-wrap;
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        .metric-card {
            background: var(--clockwork-darker);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--clockwork-primary);
            line-height: 1;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 0.875rem;
            color: var(--clockwork-gray);
        }
        
        /* Dark theme inputs and selects */
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"],
        input[type="date"],
        input[type="time"],
        input[type="url"],
        input[type="tel"],
        textarea,
        select {
            background: var(--clockwork-darker);
            color: var(--clockwork-text);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus,
        input[type="time"]:focus,
        input[type="url"]:focus,
        input[type="tel"]:focus,
        textarea:focus,
        select:focus {
            border-color: var(--clockwork-primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Scrollbar styling for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--clockwork-darker);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Dark theme for tables */
        table {
            color: var(--clockwork-text);
            width: 100%;
        }

        thead tr {
            background: var(--clockwork-darker) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        tbody tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
        }

        tbody tr:hover {
            background: rgba(255, 255, 255, 0.05) !important;
        }
        
        /* Responsive Table */
        .responsive-table {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        @media (max-width: 767px) {
            .responsive-table table {
                font-size: 0.875rem;
            }
            
            .responsive-table th,
            .responsive-table td {
                padding: 0.5rem;
            }
            
            .hide-mobile {
                display: none !important;
            }
        }
        
        /* Print Styles */
        @media print {
            body {
                background: white;
                color: black;
            }
            
            .no-print {
                display: none !important;
            }
            
            .clockwork-card {
                border: 1px solid #ddd;
                box-shadow: none;
            }
        }
        
        /* Accessibility Improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        /* Focus Visible */
        :focus-visible {
            outline: 2px solid var(--clockwork-primary);
            outline-offset: 2px;
        }
        
        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            .clockwork-card {
                border-width: 2px;
            }
            
            .clockwork-button {
                border: 2px solid currentColor;
            }
        }
        
        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
        
        /* Cross-browser compatibility */
        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="time"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }
        
        /* Firefox scrollbar */
        * {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.1) var(--clockwork-darker);
        }
        
        /* Safari-specific fixes */
        @supports (-webkit-touch-callout: none) {
            .clockwork-input,
            .clockwork-select {
                -webkit-appearance: none;
            }
        }
        
        /* Edge-specific fixes */
        @supports (-ms-ime-align: auto) {
            .clockwork-input {
                line-height: normal;
            }
        }
        
        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--clockwork-error);
            color: white;
            font-size: 0.75rem;
            padding: 0.125rem 0.375rem;
            border-radius: 9999px;
            min-width: 18px;
            text-align: center;
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--clockwork-dark);
            color: var(--clockwork-text);
            text-align: center;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Permission Matrix */
        .permission-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .permission-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--clockwork-darker);
            border-radius: 6px;
        }
        
        .permission-item input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
            cursor: pointer;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--clockwork-gray);
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .empty-state-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--clockwork-text);
        }
        
        .empty-state-description {
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        // Demo accounts with multiple roles support
        const demoAccounts = {
            'john.client@example.com': { 
                password: 'password123', 
                roles: ['client'], 
                name: 'John Anderson',
                id: 'client_001',
                specialistIds: ['specialist_001', 'specialist_002'],
                phone: '+1-555-123-4567',
                address: '123 Main St, Anytown, USA',
                subscriptionPlan: 'premium',
                paymentMethod: { type: 'card', last4: '4242' }
            },
            'sarah.specialist@clockwork.com': { 
                password: 'specialist123', 
                roles: ['specialist'], 
                name: 'Dr. Sarah Mitchell',
                id: 'specialist_001',
                clientIds: ['client_001'],
                phone: '+1-555-234-5678',
                specialization: 'Physical Therapy',
                billingEnabled: true
            },
            'mike.specialist@clockwork.com': { 
                password: 'specialist123', 
                roles: ['specialist'], 
                name: 'Dr. Mike Johnson',
                id: 'specialist_002',
                clientIds: ['client_001'],
                phone: '+1-555-345-6789',
                specialization: 'Nutrition',
                billingEnabled: true
            },
            'admin@clockwork.com': { 
                password: 'admin123', 
                roles: ['admin', 'specialist'], 
                name: 'Admin User',
                id: 'admin_001',
                clientIds: [],
                phone: '+1-555-456-7890',
                billingEnabled: true
            },
            'owner@clockwork.com': { 
                password: 'owner123', 
                roles: ['owner', 'admin', 'specialist'], 
                name: 'Josh Lerner',
                id: 'owner_001',
                clientIds: [],
                phone: '+1-555-567-8901',
                billingEnabled: true,
                canTrainClients: true,
                canAssignBilling: true
            },
            'engineer@clockwork.com': { 
                password: 'engineer123', 
                roles: ['engineer', 'admin'], 
                name: 'Technical Admin',
                id: 'engineer_001',
                phone: '+1-555-678-9012'
            }
        };

        // Initialize demo data
        const initDemoData = () => {
            return {
                measurements: [
                    { 
                        id: 1, 
                        date: '2024-01-15', 
                        weight: 165, 
                        bodyFat: 18.2, 
                        bmr: 1650, 
                        bloodPressure: '120/80', 
                        clientId: 'client_001',
                        circumference: {
                            neck: 15.5,
                            shoulders: 45,
                            chest: 42,
                            upperArm: 14,
                            lowerArm: 11,
                            waist: 34,
                            hips: 40,
                            upperThigh: 24,
                            calf: 15
                        },
                        caliper: {
                            chest: 10,
                            abdominal: 15,
                            thigh: 12,
                            bicep: 8,
                            tricep: 10,
                            subscapular: 12,
                            suprailiac: 14,
                            lowerBack: 11,
                            calf: 9
                        }
                    },
                    { 
                        id: 2, 
                        date: '2024-02-14', 
                        weight: 163, 
                        bodyFat: 17.8, 
                        bmr: 1635, 
                        bloodPressure: '118/78', 
                        clientId: 'client_001',
                        circumference: {
                            neck: 15.3,
                            shoulders: 44.5,
                            chest: 41.5,
                            upperArm: 13.8,
                            lowerArm: 10.9,
                            waist: 33,
                            hips: 39.5,
                            upperThigh: 23.5,
                            calf: 14.8
                        },
                        caliper: {
                            chest: 9,
                            abdominal: 14,
                            thigh: 11,
                            bicep: 7,
                            tricep: 9,
                            subscapular: 11,
                            suprailiac: 13,
                            lowerBack: 10,
                            calf: 8
                        }
                    }
                ],
                workouts: [
                    {
                        id: 1,
                        name: 'Upper Body Strength',
                        clientId: 'client_001',
                        assignedBy: 'specialist_001',
                        exerciseImage: null,
                        youtubeLink: 'https://www.youtube.com/watch?v=example',
                        exercises: [
                            { 
                                id: 1, 
                                name: 'Push-ups', 
                                sets: 3, 
                                reps: 15, 
                                weight: 0,
                                actualSets: 3,
                                actualReps: 15,
                                actualWeight: 0,
                                painLevel: 1,
                                specialistNote: 'Focus on proper form'
                            },
                            { 
                                id: 2, 
                                name: 'Pull-ups', 
                                sets: 3, 
                                reps: 8, 
                                weight: 0,
                                actualSets: 3,
                                actualReps: 6,
                                actualWeight: 0,
                                painLevel: 2,
                                specialistNote: 'Use assistance band if needed'
                            }
                        ],
                        completed: true,
                        moodFeedback: 4,
                        notes: 'Felt good overall, slight shoulder discomfort',
                        completedDate: '2024-02-15'
                    }
                ],
                nutrition: {
                    clientId: 'client_001',
                    assignedBy: 'specialist_001',
                    protein: { target: 165, current: 155 },
                    carbs: { target: 200, current: 180 },
                    fat: { target: 60, current: 58 },
                    calories: { target: 2000, current: 1890 },
                    mealPlan: {
                        breakfast: 'Oatmeal with berries and protein powder',
                        lunch: 'Grilled chicken salad with quinoa',
                        dinner: 'Salmon with vegetables and sweet potato',
                        snacks: 'Greek yogurt, nuts, protein shake'
                    }
                },
                goals: [
                    { id: 1, name: 'Weight Loss Goal', target: 155, current: 163, deadline: '2024-06-30', clientId: 'client_001', assignedBy: 'specialist_001' },
                    { id: 2, name: 'Body Fat Reduction', target: 15, current: 17.8, deadline: '2024-08-30', clientId: 'client_001', assignedBy: 'specialist_001' }
                ],
                tests: [
                    { id: 1, name: 'Body Composition Analysis', date: '2024-01-15', results: 'Body fat: 18.2%, Muscle mass: 142lbs, Water: 58%', clientId: 'client_001', performedBy: 'specialist_001' },
                    { id: 2, name: 'VO2 Max Test', date: '2024-02-01', results: 'VO2 Max: 45 ml/kg/min - Above average for age group', clientId: 'client_001', performedBy: 'specialist_002' }
                ],
                billing: {
                    invoices: [
                        {
                            id: 'INV-001',
                            clientId: 'client_001',
                            issuedBy: 'specialist_001',
                            date: '2024-02-01',
                            dueDate: '2024-02-15',
                            amount: 299.00,
                            status: 'paid',
                            description: 'Monthly Training Package',
                            items: [
                                { description: 'Personal Training Sessions (8)', amount: 200.00 },
                                { description: 'Nutrition Planning', amount: 50.00 },
                                { description: 'Progress Assessment', amount: 49.00 }
                            ],
                            paymentMethod: 'card',
                            paidDate: '2024-02-10'
                        },
                        {
                            id: 'INV-002',
                            clientId: 'client_001',
                            issuedBy: 'specialist_001',
                            date: '2024-03-01',
                            dueDate: '2024-03-15',
                            amount: 299.00,
                            status: 'pending',
                            description: 'Monthly Training Package',
                            items: [
                                { description: 'Personal Training Sessions (8)', amount: 200.00 },
                                { description: 'Nutrition Planning', amount: 50.00 },
                                { description: 'Progress Assessment', amount: 49.00 }
                            ]
                        }
                    ],
                    payments: [
                        {
                            id: 'PAY-001',
                            invoiceId: 'INV-001',
                            clientId: 'client_001',
                            amount: 299.00,
                            date: '2024-02-10',
                            method: 'card',
                            last4: '4242',
                            status: 'completed'
                        }
                    ],
                    subscriptions: [
                        {
                            id: 'SUB-001',
                            clientId: 'client_001',
                            specialistId: 'specialist_001',
                            name: 'Premium Training Package',
                            amount: 299.00,
                            frequency: 'monthly',
                            status: 'active',
                            startDate: '2024-01-01',
                            nextBillingDate: '2024-03-01',
                            features: [
                                '8 Personal Training Sessions',
                                'Custom Nutrition Plan',
                                'Monthly Progress Assessment',
                                '24/7 Chat Support'
                            ]
                        }
                    ]
                },
                trainingSessions: [
                    {
                        id: 'SESSION-001',
                        trainerId: 'owner_001',
                        clientId: 'client_001',
                        date: '2024-02-20',
                        time: '14:00',
                        duration: 60,
                        type: 'Personal Training',
                        status: 'scheduled',
                        notes: 'Focus on upper body strength'
                    },
                    {
                        id: 'SESSION-002',
                        trainerId: 'specialist_001',
                        clientId: 'client_001',
                        date: '2024-02-18',
                        time: '10:00',
                        duration: 45,
                        type: 'Physical Therapy',
                        status: 'completed',
                        notes: 'Shoulder mobility work'
                    }
                ]
            };
        };

        // ClockWork Logo Component
        const ClockWorkLogo = ({ size = 'large' }) => {
            const [logoUrl, setLogoUrl] = useState(() => {
                try {
                    return localStorage.getItem('clockworkLogo') || null;
                } catch (error) {
                    console.error('Error loading logo:', error);
                    return null;
                }
            });
            const logoSize = size === 'large' ? 80 : 40;
            const fontSize = size === 'large' ? 'text-2xl sm:text-3xl' : 'text-base sm:text-lg';
            const textSize = size === 'large' ? 'text-xs' : 'text-xxs';
            
            const handleLogoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        try {
                            setLogoUrl(reader.result);
                            localStorage.setItem('clockworkLogo', reader.result);
                        } catch (error) {
                            console.error('Error saving logo:', error);
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            return (
                <div className={`clockwork-logo ${size === 'small' ? 'small' : ''}`}>
                    <div className="logo-icon" style={{ width: logoSize, height: logoSize }}>
                        {logoUrl ? (
                            <img 
                                src={logoUrl} 
                                alt="ClockWork Logo" 
                                style={{ 
                                    width: '100%', 
                                    height: '100%', 
                                    objectFit: 'contain',
                                    borderRadius: '50%',
                                    position: 'relative',
                                    zIndex: 2
                                }}
                            />
                        ) : null}
                        {size === 'large' && (
                            <input
                                type="file"
                                accept="image/*"
                                onChange={handleLogoUpload}
                                style={{
                                    position: 'absolute',
                                    top: 0,
                                    left: 0,
                                    width: '100%',
                                    height: '100%',
                                    opacity: 0,
                                    cursor: 'pointer',
                                    zIndex: 3
                                }}
                                title="Click to upload logo"
                            />
                        )}
                    </div>
                    <div>
                        <div className={`font-bold ${fontSize} logo-text-primary`}>
                            CLOCKWORK
                        </div>
                        <div className={`${textSize} tracking-wider logo-text-secondary`}>
                            UNIVERSAL BUSINESS PLATFORM
                        </div>
                    </div>
                </div>
            );
        };

        // Error Boundary Component
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }

            componentDidCatch(error, errorInfo) {
                console.error('Error caught by boundary:', error, errorInfo);
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="min-h-screen flex items-center justify-center bg-slate-900">
                            <div className="text-center p-4">
                                <h2 className="text-xl sm:text-2xl font-bold text-red-400 mb-4">Something went wrong</h2>
                                <p className="text-gray-400 mb-4">Please refresh the page or try again.</p>
                                <button 
                                    onClick={() => window.location.reload()}
                                    className="clockwork-button"
                                >
                                    Refresh Page
                                </button>
                            </div>
                        </div>
                    );
                }

                return this.props.children;
            }
        }

        // Main App Component
        const App = () => {
            const [currentUser, setCurrentUser] = useState(() => {
                try {
                    const saved = sessionStorage.getItem('clockworkUser');
                    return saved ? JSON.parse(saved) : null;
                } catch (error) {
                    console.error('Error loading user:', error);
                    return null;
                }
            });

            const [activeTab, setActiveTab] = useState('dashboard');
            const [clientData, setClientData] = useState(() => {
                try {
                    const saved = localStorage.getItem('clockworkClientData');
                    return saved ? JSON.parse(saved) : initDemoData();
                } catch (error) {
                    console.error('Error loading client data:', error);
                    return initDemoData();
                }
            });

            const [selectedClient, setSelectedClient] = useState(null);
            const [messages, setMessages] = useState(() => {
                try {
                    const saved = localStorage.getItem('clockworkMessages');
                    return saved ? JSON.parse(saved) : {
                        // Initialize with some demo messages
                        'client_001-specialist_001': [
                            {
                                id: 1,
                                text: 'Hi John! How are you feeling after yesterday\'s workout?',
                                sender: 'specialist_001',
                                senderName: 'Dr. Sarah Mitchell',
                                timestamp: new Date(Date.now() - 86400000).toISOString(),
                                read: true
                            },
                            {
                                id: 2,
                                text: 'Hi Dr. Mitchell! I\'m feeling great, just a bit sore in my shoulders.',
                                sender: 'client_001',
                                senderName: 'John Anderson',
                                timestamp: new Date(Date.now() - 85000000).toISOString(),
                                read: true
                            }
                        ]
                    };
                } catch (error) {
                    console.error('Error loading messages:', error);
                    return {};
                }
            });

            const [allUsers, setAllUsers] = useState(() => {
                try {
                    const saved = localStorage.getItem('clockworkAllUsers');
                    if (saved) {
                        return JSON.parse(saved);
                    }
                    return Object.entries(demoAccounts).map(([email, data]) => ({ 
                        ...data, 
                        email,
                        online: Math.random() > 0.5
                    }));
                } catch (error) {
                    console.error('Error loading users:', error);
                    return Object.entries(demoAccounts).map(([email, data]) => ({ 
                        ...data, 
                        email,
                        online: Math.random() > 0.5
                    }));
                }
            });

            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [successMessage, setSuccessMessage] = useState(null);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

            // Save data to storage whenever it changes
            useEffect(() => {
                try {
                    if (currentUser) {
                        sessionStorage.setItem('clockworkUser', JSON.stringify(currentUser));
                    } else {
                        sessionStorage.removeItem('clockworkUser');
                    }
                } catch (error) {
                    console.error('Error saving user:', error);
                }
            }, [currentUser]);

            useEffect(() => {
                try {
                    localStorage.setItem('clockworkClientData', JSON.stringify(clientData));
                } catch (error) {
                    console.error('Error saving client data:', error);
                }
            }, [clientData]);

            useEffect(() => {
                try {
                    localStorage.setItem('clockworkMessages', JSON.stringify(messages));
                } catch (error) {
                    console.error('Error saving messages:', error);
                }
            }, [messages]);

            useEffect(() => {
                try {
                    localStorage.setItem('clockworkAllUsers', JSON.stringify(allUsers));
                } catch (error) {
                    console.error('Error saving users:', error);
                }
            }, [allUsers]);

            // Helper functions
            const hasRole = (role) => currentUser?.roles?.includes(role);
            const hasAnyRole = (...roles) => roles.some(role => hasRole(role));

            // Get clients for current specialist/admin/owner
            const getMyClients = () => {
                if (hasRole('owner') || hasRole('admin')) {
                    return allUsers.filter(u => u.roles.includes('client'));
                } else if (hasRole('specialist')) {
                    return allUsers.filter(u => 
                        u.roles.includes('client') && 
                        currentUser.clientIds?.includes(u.id)
                    );
                }
                return [];
            };

            // Clear error after 5 seconds
            useEffect(() => {
                if (error) {
                    const timer = setTimeout(() => setError(null), 5000);
                    return () => clearTimeout(timer);
                }
            }, [error]);

            // Clear success message after 5 seconds
            useEffect(() => {
                if (successMessage) {
                    const timer = setTimeout(() => setSuccessMessage(null), 5000);
                    return () => clearTimeout(timer);
                }
            }, [successMessage]);

            // Login Component
            const LoginForm = () => {
                const [email, setEmail] = useState('');
                const [password, setPassword] = useState('');
                const [loginError, setLoginError] = useState('');
                const [isSignup, setIsSignup] = useState(false);
                const [name, setName] = useState('');
                const [phone, setPhone] = useState('');
                const [isLoading, setIsLoading] = useState(false);
                const [showResetPassword, setShowResetPassword] = useState(false);
                const [resetEmail, setResetEmail] = useState('');
                const [resetMessage, setResetMessage] = useState('');

                const handleAuth = async (e) => {
                    e.preventDefault();
                    setIsLoading(true);
                    setLoginError('');
                    
                    try {
                        if (isSignup) {
                            await new Promise(resolve => setTimeout(resolve, 1000));
                            
                            // Check if email already exists
                            const emailExists = allUsers.some(u => u.email === email) || Object.keys(demoAccounts).includes(email);
                            if (emailExists) {
                                setLoginError('Email already exists. Please use a different email or login.');
                                return;
                            }
                            
                            const newUser = {
                                id: `client_${Date.now()}`,
                                email,
                                password,
                                name: name || email.split('@')[0],
                                phone: phone || '',
                                roles: ['client'],
                                specialistIds: [],
                                clientIds: [],
                                online: true,
                                subscriptionPlan: 'basic',
                                paymentMethod: null
                            };
                            
                            // Add to allUsers
                            setAllUsers(prev => [...prev, newUser]);
                            
                            // Set as current user
                            setCurrentUser(newUser);
                        } else {
                            await new Promise(resolve => setTimeout(resolve, 800));
                            
                            // Check demo accounts first
                            const demoUser = demoAccounts[email];
                            if (demoUser && demoUser.password === password) {
                                setCurrentUser({ ...demoUser, email });
                            } else {
                                // Check dynamically created users
                                const dynamicUser = allUsers.find(u => u.email === email && u.password === password);
                                if (dynamicUser) {
                                    setCurrentUser(dynamicUser);
                                } else {
                                    setLoginError('Invalid credentials. Please try again.');
                                }
                            }
                        }
                    } catch (error) {
                        setLoginError('An error occurred. Please try again.');
                        console.error('Auth error:', error);
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handlePasswordReset = async (e) => {
                    e.preventDefault();
                    setIsLoading(true);
                    setResetMessage('');
                    
                    try {
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                        // Check if email exists in demo accounts
                        const userExists = Object.keys(demoAccounts).includes(resetEmail) || 
                                         allUsers.some(u => u.email === resetEmail);
                        
                        if (userExists) {
                            setResetMessage('Password reset link sent to your email! Check your inbox.');
                            setTimeout(() => {
                                setShowResetPassword(false);
                                setResetEmail('');
                                setResetMessage('');
                            }, 3000);
                        } else {
                            setResetMessage('Email not found. Please check and try again.');
                        }
                    } catch (error) {
                        setResetMessage('Error sending reset link. Please try again.');
                    } finally {
                        setIsLoading(false);
                    }
                };

                if (showResetPassword) {
                    return (
                        <div className="clockwork-gradient flex items-center justify-center min-h-screen p-4">
                            <div className="login-card">
                                <ClockWorkLogo size="large" />
                                <h2 className="text-xl sm:text-2xl font-bold text-center mb-2 text-white">Reset Password</h2>
                                <p className="text-gray-400 text-center mb-6">
                                    Enter your email address and we'll send you a link to reset your password.
                                </p>
                                
                                <form onSubmit={handlePasswordReset}>
                                    <div className="form-group">
                                        <label className="form-label">Email Address</label>
                                        <input
                                            type="email"
                                            value={resetEmail}
                                            onChange={(e) => setResetEmail(e.target.value)}
                                            className="clockwork-input"
                                            placeholder="Enter your email"
                                            required
                                        />
                                    </div>
                                    
                                    {resetMessage && (
                                        <div className={resetMessage.includes('sent') ? 'success-message' : 'error-message'}>
                                            {resetMessage}
                                        </div>
                                    )}
                                    
                                    <button 
                                        type="submit" 
                                        className="clockwork-button login flex items-center justify-center gap-2"
                                        disabled={isLoading}
                                    >
                                        {isLoading && <div className="loading-spinner"></div>}
                                        Send Reset Link
                                    </button>
                                </form>
                                
                                <div className="text-center mt-4">
                                    <button
                                        onClick={() => {
                                            setShowResetPassword(false);
                                            setResetEmail('');
                                            setResetMessage('');
                                        }}
                                        className="text-blue-400 hover:text-blue-300"
                                    >
                                        ← Back to Login
                                    </button>
                                </div>
                            </div>
                        </div>
                    );
                }

                return (
                    <div className="clockwork-gradient flex items-center justify-center min-h-screen p-4">
                        <div className="login-card">
                            <ClockWorkLogo size="large" />
                            <p className="brand-tagline">Universal Business Platform</p>
                            
                            <div className="login-toggle">
                                <button
                                    onClick={() => setIsSignup(false)}
                                    className={!isSignup ? 'active' : ''}
                                >
                                    Login
                                </button>
                                <button
                                    onClick={() => setIsSignup(true)}
                                    className={isSignup ? 'active' : ''}
                                >
                                    Sign Up
                                </button>
                            </div>
                            
                            <form onSubmit={handleAuth}>
                                {isSignup && (
                                    <>
                                        <div className="form-group">
                                            <label className="form-label">Full Name</label>
                                            <input
                                                type="text"
                                                value={name}
                                                onChange={(e) => setName(e.target.value)}
                                                className="clockwork-input"
                                                placeholder="Enter your full name"
                                                required
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Phone Number</label>
                                            <input
                                                type="tel"
                                                value={phone}
                                                onChange={(e) => setPhone(e.target.value)}
                                                className="clockwork-input"
                                                placeholder="+1-555-123-4567"
                                            />
                                        </div>
                                    </>
                                )}
                                
                                <div className="form-group">
                                    <label className="form-label">Email Address</label>
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        className="clockwork-input"
                                        placeholder="Enter your email"
                                        required
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Password</label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="clockwork-input"
                                        placeholder="Enter your password"
                                        required
                                    />
                                </div>
                                
                                {loginError && (
                                    <div className="error-message">{loginError}</div>
                                )}
                                
                                <button 
                                    type="submit" 
                                    className="clockwork-button login flex items-center justify-center gap-2"
                                    disabled={isLoading}
                                >
                                    {isLoading && <div className="loading-spinner"></div>}
                                    {isSignup ? 'Start Your Journey' : 'Sign In'}
                                </button>
                            </form>
                            
                            {!isSignup && (
                                <>
                                    <div className="forgot-password" style={{ textAlign: 'center', marginTop: '1.5rem' }}>
                                        <button 
                                            onClick={() => setShowResetPassword(true)}
                                            style={{ 
                                                color: '#60a5fa', 
                                                textDecoration: 'none', 
                                                fontWeight: 500,
                                                background: 'none',
                                                border: 'none',
                                                cursor: 'pointer'
                                            }}
                                        >
                                            Forgot Password?
                                        </button>
                                    </div>
                                    
                                    <div className="mt-6 p-4 bg-slate-800/50 rounded-lg">
                                        <p className="text-sm text-gray-400 mb-2">Demo Accounts:</p>
                                        <div className="space-y-1 text-xs text-gray-500">
                                            <div>Owner: owner@clockwork.com / owner123</div>
                                            <div>Admin: admin@clockwork.com / admin123</div>
                                            <div>Specialist: sarah.specialist@clockwork.com / specialist123</div>
                                            <div>Client: john.client@example.com / password123</div>
                                        </div>
                                    </div>
                                </>
                            )}
                        </div>
                    </div>
                );
            };

            // Navigation Component
            const Navigation = () => {
                const tabs = [
                    { id: 'dashboard', label: 'Dashboard', icon: '📊', iconClass: 'fas fa-chart-line' },
                    { id: 'measurements', label: 'Measurements', icon: '📏', iconClass: 'fas fa-ruler' },
                    { id: 'nutrition', label: 'Nutrition', icon: '🥗', iconClass: 'fas fa-apple-alt' },
                    { id: 'workouts', label: 'Workouts', icon: '💪', iconClass: 'fas fa-dumbbell' },
                    { id: 'goals', label: 'Goals', icon: '🎯', iconClass: 'fas fa-bullseye' },
                    { id: 'chat', label: 'Chat', icon: '💬', iconClass: 'fas fa-comments' },
                    { id: 'reports', label: 'Reports', icon: '📈', iconClass: 'fas fa-file-alt' }
                ];

                if (hasAnyRole('specialist', 'admin', 'owner') && (currentUser.billingEnabled || hasRole('owner'))) {
                    tabs.push({ id: 'billing', label: 'Billing', icon: '💳', iconClass: 'fas fa-credit-card' });
                }

                if (hasRole('owner') && currentUser.canTrainClients) {
                    tabs.push({ id: 'training', label: 'Training', icon: '🏋️', iconClass: 'fas fa-user-graduate' });
                }

                if (hasAnyRole('admin', 'owner')) {
                    tabs.push({ id: 'users', label: 'Users', icon: '👥', iconClass: 'fas fa-users' });
                }

                if (hasAnyRole('specialist', 'admin', 'owner')) {
                    tabs.push({ id: 'tests', label: 'Tests', icon: '🧪', iconClass: 'fas fa-flask' });
                }

                if (hasAnyRole('engineer', 'owner')) {
                    tabs.push({ id: 'engineer', label: 'Engineer', icon: '🔧', iconClass: 'fas fa-cogs' });
                }

                const exportMyData = () => {
                    try {
                        let exportContent = "CLOCKWORK PLATFORM - MY DATA EXPORT\n";
                        exportContent += "===================================\n\n";
                        
                        exportContent += "USER INFORMATION\n";
                        exportContent += "----------------\n";
                        exportContent += `Name: ${currentUser.name}\n`;
                        exportContent += `Email: ${currentUser.email}\n`;
                        exportContent += `Phone: ${currentUser.phone || 'Not provided'}\n`;
                        exportContent += `Roles: ${currentUser.roles.join(', ')}\n`;
                        exportContent += `Export Date: ${new Date().toISOString()}\n\n`;
                        
                        if (hasRole('client')) {
                            const myMeasurements = clientData.measurements.filter(m => m.clientId === currentUser.id);
                            exportContent += "MEASUREMENTS\n";
                            exportContent += "------------\n";
                            myMeasurements.forEach(m => {
                                exportContent += `Date: ${m.date} | Weight: ${m.weight}lbs | Body Fat: ${m.bodyFat}% | BMR: ${m.bmr} | BP: ${m.bloodPressure}\n`;
                            });
                            exportContent += "\n";
                            
                            const myWorkouts = clientData.workouts.filter(w => w.clientId === currentUser.id);
                            exportContent += "WORKOUTS\n";
                            exportContent += "--------\n";
                            myWorkouts.forEach(w => {
                                exportContent += `${w.name} - ${w.completed ? 'Completed' : 'Pending'}`;
                                if (w.moodFeedback) exportContent += ` - Mood: ${w.moodFeedback}/5`;
                                if (w.completedDate) exportContent += ` - Date: ${w.completedDate}`;
                                exportContent += "\n";
                            });
                            exportContent += "\n";
                            
                            const myGoals = clientData.goals.filter(g => g.clientId === currentUser.id);
                            exportContent += "GOALS\n";
                            exportContent += "-----\n";
                            myGoals.forEach(g => {
                                const progress = Math.round((g.current / g.target) * 100);
                                exportContent += `${g.name} - Progress: ${g.current}/${g.target} (${progress}%) - Deadline: ${g.deadline}\n`;
                            });
                            exportContent += "\n";
                            
                            const myTests = clientData.tests.filter(t => t.clientId === currentUser.id);
                            exportContent += "TESTS\n";
                            exportContent += "-----\n";
                            myTests.forEach(t => {
                                exportContent += `${t.name} - Date: ${t.date}\n`;
                                exportContent += `Results: ${t.results}\n\n`;
                            });
                            
                            const myInvoices = clientData.billing?.invoices?.filter(i => i.clientId === currentUser.id) || [];
                            exportContent += "BILLING HISTORY\n";
                            exportContent += "---------------\n";
                            myInvoices.forEach(i => {
                                exportContent += `Invoice ${i.id} - Date: ${i.date} - Amount: $${i.amount.toFixed(2)} - Status: ${i.status}\n`;
                            });
                        }
                        
                        const blob = new Blob([exportContent], { type: 'text/plain;charset=utf-8;' });
                        const link = document.createElement('a');
                        const url = URL.createObjectURL(blob);
                        link.setAttribute('href', url);
                        link.setAttribute('download', `my-clockwork-data-${new Date().toISOString().split('T')[0]}.txt`);
                        link.style.visibility = 'hidden';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                    } catch (error) {
                        console.error('Error exporting data:', error);
                        setError('Error exporting data. Please try again.');
                    }
                };

                return (
                    <>
                        {/* Desktop Navigation */}
                        <nav className="clockwork-card mb-6 px-6 py-4 desktop-nav">
                            <div className="flex justify-between items-center mb-4">
                                <ClockWorkLogo size="small" />
                                <div className="flex items-center gap-2 sm:gap-4">
                                    <div className="hidden sm:flex gap-2">
                                        {currentUser.roles.map(role => (
                                            <span key={role} className={`clockwork-badge badge-${role}`}>
                                                {role}
                                            </span>
                                        ))}
                                    </div>
                                    <span className="text-gray-300 hidden sm:inline">{currentUser.name}</span>
                                    <button 
                                        onClick={exportMyData}
                                        className="clockwork-button-secondary text-sm"
                                    >
                                        <span className="hidden sm:inline">📊 Export My Data</span>
                                        <span className="sm:hidden">📊</span>
                                    </button>
                                    <button 
                                        onClick={() => setCurrentUser(null)}
                                        className="text-gray-400 hover:text-gray-200"
                                    >
                                        <span className="hidden sm:inline">Logout</span>
                                        <i className="fas fa-sign-out-alt sm:hidden"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div className="flex gap-2 overflow-x-auto no-scrollbar">
                                {tabs.map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`clockwork-tab ${activeTab === tab.id ? 'active' : ''}`}
                                    >
                                        <span className="mr-2">{tab.icon}</span>
                                        <span className="hidden sm:inline">{tab.label}</span>
                                    </button>
                                ))}
                            </div>
                        </nav>

                        {/* Mobile Navigation */}
                        <nav className="mobile-nav">
                            {tabs.slice(0, 5).map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`mobile-nav-item ${activeTab === tab.id ? 'active' : ''}`}
                                >
                                    <i className={tab.iconClass}></i>
                                    <span>{tab.label}</span>
                                </button>
                            ))}
                            <button
                                onClick={() => setMobileMenuOpen(true)}
                                className="mobile-nav-item"
                            >
                                <i className="fas fa-ellipsis-h"></i>
                                <span>More</span>
                            </button>
                        </nav>

                        {/* Mobile Menu Overlay */}
                        {mobileMenuOpen && (
                            <div className="modal-overlay" onClick={() => setMobileMenuOpen(false)}>
                                <div className="modal-content max-w-sm" onClick={(e) => e.stopPropagation()}>
                                    <h3 className="text-lg font-semibold mb-4 text-white">Menu</h3>
                                    
                                    <div className="space-y-2">
                                        {tabs.map(tab => (
                                            <button
                                                key={tab.id}
                                                onClick={() => {
                                                    setActiveTab(tab.id);
                                                    setMobileMenuOpen(false);
                                                }}
                                                className={`w-full text-left p-3 rounded-lg flex items-center gap-3 transition-colors ${
                                                    activeTab === tab.id 
                                                        ? 'bg-blue-500 text-white' 
                                                        : 'bg-slate-800 text-gray-300 hover:bg-slate-700'
                                                }`}
                                            >
                                                <i className={tab.iconClass}></i>
                                                <span>{tab.label}</span>
                                            </button>
                                        ))}
                                        
                                        <hr className="border-gray-700 my-4" />
                                        
                                        <div className="p-3">
                                            <p className="text-sm text-gray-400 mb-2">Logged in as:</p>
                                            <p className="font-semibold text-white">{currentUser.name}</p>
                                            <div className="flex gap-2 mt-2">
                                                {currentUser.roles.map(role => (
                                                    <span key={role} className={`clockwork-badge badge-${role}`}>
                                                        {role}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>
                                        
                                        <button
                                            onClick={() => {
                                                exportMyData();
                                                setMobileMenuOpen(false);
                                            }}
                                            className="w-full text-left p-3 rounded-lg bg-amber-500/20 text-amber-400 hover:bg-amber-500/30"
                                        >
                                            <i className="fas fa-download mr-3"></i>
                                            Export My Data
                                        </button>
                                        
                                        <button
                                            onClick={() => setCurrentUser(null)}
                                            className="w-full text-left p-3 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30"
                                        >
                                            <i className="fas fa-sign-out-alt mr-3"></i>
                                            Logout
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </>
                );
            };

            // Dashboard Component (Complete)
            const Dashboard = () => {
                const currentClientId = hasRole('client') ? currentUser.id : selectedClient?.id;
                const displayName = hasRole('client') ? currentUser.name : selectedClient?.name || 'Select a client';
                
                const latestMeasurement = clientData.measurements
                    .filter(m => hasRole('client') ? m.clientId === currentUser.id : (selectedClient ? m.clientId === selectedClient.id : false))
                    .slice(-1)[0] || {};
                
                const chartRef = useRef(null);
                const chartInstance = useRef(null);
                const [selectedMetrics, setSelectedMetrics] = useState(['weight']);
                const [showCircumferenceChart, setShowCircumferenceChart] = useState(false);
                const circumferenceChartRef = useRef(null);
                const circumferenceChartInstance = useRef(null);

                const myWorkouts = clientData.workouts.filter(w => 
                    hasRole('client') ? w.clientId === currentUser.id : (selectedClient ? w.clientId === selectedClient.id : false)
                );

                const myGoals = clientData.goals.filter(g => 
                    hasRole('client') ? g.clientId === currentUser.id : (selectedClient ? g.clientId === selectedClient.id : false)
                );

                const getAveragePainLevel = () => {
                    const completedWorkouts = myWorkouts.filter(w => w.completed);
                    if (completedWorkouts.length === 0) return 0;
                    
                    let totalPain = 0;
                    let exerciseCount = 0;
                    
                    completedWorkouts.forEach(workout => {
                        workout.exercises.forEach(exercise => {
                            if (exercise.painLevel !== undefined) {
                                totalPain += exercise.painLevel;
                                exerciseCount++;
                            }
                        });
                    });
                    
                    return exerciseCount > 0 ? (totalPain / exerciseCount).toFixed(1) : 0;
                };

                const getRecentMoodFeedback = () => {
                    const completedWorkouts = myWorkouts
                        .filter(w => w.completed && w.moodFeedback)
                        .sort((a, b) => new Date(b.completedDate || 0) - new Date(a.completedDate || 0))
                        .slice(0, 5);
                    
                    return completedWorkouts;
                };

                const getUpcomingBilling = () => {
                    if (!hasRole('client')) return null;
                    
                    const activeSubscription = clientData.billing?.subscriptions?.find(
                        s => s.clientId === currentUser.id && s.status === 'active'
                    );
                    
                    return activeSubscription;
                };

                const getPendingInvoices = () => {
                    if (!hasRole('client')) return [];
                    
                    return clientData.billing?.invoices?.filter(
                        i => i.clientId === currentUser.id && i.status === 'pending'
                    ) || [];
                };

                useEffect(() => {
                    if (chartRef.current && (selectedClient || hasRole('client'))) {
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }

                        const relevantMeasurements = clientData.measurements.filter(m => 
                            hasRole('client') ? m.clientId === currentUser.id : m.clientId === selectedClient?.id
                        );

                        const datasets = [];
                        const colors = {
                            weight: '#3b82f6',
                            bodyFat: '#fbbf24',
                            bmr: '#10b981'
                        };

                        if (selectedMetrics.includes('weight')) {
                            datasets.push({
                                label: 'Weight (lbs)',
                                data: relevantMeasurements.map(m => m.weight),
                                borderColor: colors.weight,
                                backgroundColor: `${colors.weight}20`,
                                tension: 0.4,
                                yAxisID: 'y-weight'
                            });
                        }

                        if (selectedMetrics.includes('bodyFat')) {
                            datasets.push({
                                label: 'Body Fat (%)',
                                data: relevantMeasurements.map(m => m.bodyFat),
                                borderColor: colors.bodyFat,
                                backgroundColor: `${colors.bodyFat}20`,
                                tension: 0.4,
                                yAxisID: 'y-bodyfat'
                            });
                        }

                        if (selectedMetrics.includes('bmr')) {
                            datasets.push({
                                label: 'BMR (cal)',
                                data: relevantMeasurements.map(m => m.bmr),
                                borderColor: colors.bmr,
                                backgroundColor: `${colors.bmr}20`,
                                tension: 0.4,
                                yAxisID: 'y-bmr'
                            });
                        }

                        const scales = {};
                        if (selectedMetrics.includes('weight')) {
                            scales['y-weight'] = {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Weight (lbs)',
                                    color: '#e2e8f0'
                                },
                                ticks: {
                                    color: '#94a3b8'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            };
                        }
                        if (selectedMetrics.includes('bodyFat')) {
                            scales['y-bodyfat'] = {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: {
                                    drawOnChartArea: false,
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                title: {
                                    display: true,
                                    text: 'Body Fat (%)',
                                    color: '#e2e8f0'
                                },
                                ticks: {
                                    color: '#94a3b8'
                                }
                            };
                        }
                        if (selectedMetrics.includes('bmr')) {
                            scales['y-bmr'] = {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: {
                                    drawOnChartArea: false,
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                title: {
                                    display: true,
                                    text: 'BMR (cal/day)',
                                    color: '#e2e8f0'
                                },
                                ticks: {
                                    color: '#94a3b8'
                                }
                            };
                        }

                        const ctx = chartRef.current.getContext('2d');
                        chartInstance.current = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: relevantMeasurements.map(m => m.date),
                                datasets: datasets
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: scales,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Health Metrics Over Time',
                                        color: '#e2e8f0'
                                    },
                                    legend: {
                                        labels: {
                                            color: '#e2e8f0'
                                        }
                                    }
                                }
                            }
                        });
                    }

                    return () => {
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }
                    };
                }, [clientData.measurements, selectedMetrics, currentUser.id, selectedClient]);

                useEffect(() => {
                    if (circumferenceChartRef.current && showCircumferenceChart && (selectedClient || hasRole('client'))) {
                        if (circumferenceChartInstance.current) {
                            circumferenceChartInstance.current.destroy();
                        }

                        const relevantMeasurements = clientData.measurements.filter(m => 
                            hasRole('client') ? m.clientId === currentUser.id : m.clientId === selectedClient?.id
                        ).filter(m => m.circumference);

                        if (relevantMeasurements.length > 0) {
                            const circumferenceKeys = Object.keys(relevantMeasurements[0].circumference);
                            const colors = ['#3b82f6', '#60a5fa', '#fbbf24', '#10b981', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16'];
                            
                            const datasets = circumferenceKeys.map((key, index) => ({
                                label: key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1'),
                                data: relevantMeasurements.map(m => m.circumference?.[key] || 0),
                                borderColor: colors[index % colors.length],
                                backgroundColor: `${colors[index % colors.length]}20`,
                                tension: 0.4
                            }));

                            const ctx = circumferenceChartRef.current.getContext('2d');
                            circumferenceChartInstance.current = new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: relevantMeasurements.map(m => m.date),
                                    datasets: datasets
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        title: {
                                            display: true,
                                            text: 'Body Circumference Measurements (inches)',
                                            color: '#e2e8f0'
                                        },
                                        legend: {
                                            labels: {
                                                color: '#e2e8f0'
                                            }
                                        }
                                    },
                                    scales: {
                                        x: {
                                            ticks: {
                                                color: '#94a3b8'
                                            },
                                            grid: {
                                                color: 'rgba(255, 255, 255, 0.1)'
                                            }
                                        },
                                        y: {
                                            ticks: {
                                                color: '#94a3b8'
                                            },
                                            grid: {
                                                color: 'rgba(255, 255, 255, 0.1)'
                                            }
                                        }
                                    }
                                }
                            });
                        }
                    }

                    return () => {
                        if (circumferenceChartInstance.current) {
                            circumferenceChartInstance.current.destroy();
                        }
                    };
                }, [showCircumferenceChart, clientData.measurements, currentUser.id, selectedClient]);

                const toggleMetric = (metric) => {
                    setSelectedMetrics(prev => 
                        prev.includes(metric) 
                            ? prev.filter(m => m !== metric)
                            : [...prev, metric]
                    );
                };

                const recentMoods = getRecentMoodFeedback();
                const avgPainLevel = getAveragePainLevel();
                const upcomingBilling = getUpcomingBilling();
                const pendingInvoices = getPendingInvoices();

                return (
                    <div className="space-y-6">
                        <div className="clockwork-card p-4 sm:p-6">
                            <h2 className="text-xl sm:text-2xl font-bold mb-2 text-white">
                                {hasRole('client') ? `Welcome back, ${currentUser.name}!` : `Dashboard - ${displayName}`}
                            </h2>
                            <p className="text-gray-400 text-sm sm:text-base">
                                {hasRole('client') ? 'Your progress journey continues today' : 'Client overview'}
                            </p>
                            
                            {hasAnyRole('specialist', 'admin', 'owner') && (
                                <div className="mt-4">
                                    <select 
                                        onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                        className="clockwork-select max-w-xs"
                                        value={selectedClient?.id || ''}
                                    >
                                        <option value="">Select a client...</option>
                                        {getMyClients().map(client => (
                                            <option key={client.id} value={client.id}>{client.name}</option>
                                        ))}
                                    </select>
                                </div>
                            )}
                        </div>

                        {(hasRole('client') || selectedClient) && (
                            <>
                                <div className="responsive-grid">
                                    <div className="stat-card">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-2xl sm:text-3xl">⚖️</span>
                                            <span className="text-xl sm:text-2xl font-bold text-gray-200">{latestMeasurement.weight || '-'} lbs</span>
                                        </div>
                                        <p className="text-sm text-gray-400">Current Weight</p>
                                        <p className="text-xs text-gray-500">{latestMeasurement.date || 'No data'}</p>
                                    </div>

                                    <div className="stat-card">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-2xl sm:text-3xl">🔥</span>
                                            <span className="text-xl sm:text-2xl font-bold text-orange-400">{latestMeasurement.bodyFat || '-'}%</span>
                                        </div>
                                        <p className="text-sm text-gray-400">Body Fat</p>
                                        <p className="text-xs text-gray-500">Current level</p>
                                    </div>

                                    <div className="stat-card">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-2xl sm:text-3xl">❤️</span>
                                            <span className="text-xl sm:text-2xl font-bold text-red-400">{latestMeasurement.bloodPressure || '-'}</span>
                                        </div>
                                        <p className="text-sm text-gray-400">Blood Pressure</p>
                                        <p className="text-xs text-gray-500">{latestMeasurement.date || 'No data'}</p>
                                    </div>

                                    <div className="stat-card">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-2xl sm:text-3xl">🏆</span>
                                            <span className="text-xl sm:text-2xl font-bold text-green-400">{myGoals.filter(g => g.current >= g.target).length}/{myGoals.length}</span>
                                        </div>
                                        <p className="text-sm text-gray-400">Goals Completed</p>
                                        <p className="text-xs text-gray-500">Keep it up!</p>
                                    </div>
                                </div>

                                {hasRole('client') && (upcomingBilling || pendingInvoices.length > 0) && (
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        {upcomingBilling && (
                                            <div className="billing-card">
                                                <h3 className="text-lg font-semibold mb-3 flex items-center gap-2 text-white">
                                                    <span>💳</span>
                                                    Active Subscription
                                                </h3>
                                                <div className="space-y-2">
                                                    <p className="text-sm text-gray-300">
                                                        <span className="font-medium">{upcomingBilling.name}</span>
                                                    </p>
                                                    <p className="text-lg font-bold text-green-400">
                                                        ${upcomingBilling.amount.toFixed(2)}/{upcomingBilling.frequency}
                                                    </p>
                                                    <p className="text-xs text-gray-400">
                                                        Next billing: {new Date(upcomingBilling.nextBillingDate).toLocaleDateString()}
                                                    </p>
                                                </div>
                                            </div>
                                        )}
                                        
                                        {pendingInvoices.length > 0 && (
                                            <div className="billing-card">
                                                <h3 className="text-lg font-semibold mb-3 flex items-center gap-2 text-white">
                                                    <span>📄</span>
                                                    Pending Invoices
                                                </h3>
                                                <div className="space-y-2">
                                                    {pendingInvoices.slice(0, 2).map(invoice => (
                                                        <div key={invoice.id} className="flex justify-between items-center">
                                                            <span className="text-sm text-gray-300">{invoice.description}</span>
                                                            <span className="text-sm font-bold text-amber-400">${invoice.amount.toFixed(2)}</span>
                                                        </div>
                                                    ))}
                                                    {pendingInvoices.length > 2 && (
                                                        <p className="text-xs text-gray-400">+{pendingInvoices.length - 2} more</p>
                                                    )}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div className="clockwork-card p-4 sm:p-6">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-lg font-semibold text-white">Progress Chart</h3>
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={() => toggleMetric('weight')}
                                                    className={`px-3 py-1 rounded text-xs ${selectedMetrics.includes('weight') ? 'bg-blue-500 text-white' : 'bg-gray-700 text-gray-300'}`}
                                                >
                                                    Weight
                                                </button>
                                                <button
                                                    onClick={() => toggleMetric('bodyFat')}
                                                    className={`px-3 py-1 rounded text-xs ${selectedMetrics.includes('bodyFat') ? 'bg-amber-500 text-white' : 'bg-gray-700 text-gray-300'}`}
                                                >
                                                    Body Fat
                                                </button>
                                                <button
                                                    onClick={() => toggleMetric('bmr')}
                                                    className={`px-3 py-1 rounded text-xs ${selectedMetrics.includes('bmr') ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-300'}`}
                                                >
                                                    BMR
                                                </button>
                                            </div>
                                        </div>
                                        <div style={{ height: '300px' }}>
                                            <canvas ref={chartRef}></canvas>
                                        </div>
                                    </div>
                                    
                                    <div className="clockwork-card p-4 sm:p-6">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-lg font-semibold text-white">Wellness Summary</h3>
                                            <span className="text-xs text-gray-400">Last 5 workouts</span>
                                        </div>
                                        
                                        <div className="space-y-4">
                                            <div className="mood-summary-card">
                                                <h4 className="font-medium mb-2 text-white">Mood Trend</h4>
                                                <div className="flex gap-2 items-center">
                                                    {recentMoods.length > 0 ? (
                                                        <>
                                                            {recentMoods.map((workout, index) => (
                                                                <div key={index} className="text-center">
                                                                    <div className="text-2xl">
                                                                        {workout.moodFeedback === 1 && '😞'}
                                                                        {workout.moodFeedback === 2 && '😕'}
                                                                        {workout.moodFeedback === 3 && '😐'}
                                                                        {workout.moodFeedback === 4 && '😊'}
                                                                        {workout.moodFeedback === 5 && '😄'}
                                                                    </div>
                                                                    <div className="text-xs text-gray-400">
                                                                        {new Date(workout.completedDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </>
                                                    ) : (
                                                        <p className="text-gray-400">No mood data yet</p>
                                                    )}
                                                </div>
                                            </div>
                                            
                                            <div className="pain-summary-card">
                                                <h4 className="font-medium mb-2 text-white">Average Pain Level</h4>
                                                <div className="flex items-center gap-4">
                                                    <div className="text-3xl font-bold text-amber-400">{avgPainLevel}</div>
                                                    <div className="flex-1">
                                                        <div className="progress-bar">
                                                            <div className="progress-fill" style={{ width: `${(avgPainLevel / 5) * 100}%` }}></div>
                                                        </div>
                                                        <p className="text-xs text-gray-400 mt-1">
                                                            {avgPainLevel < 2 ? 'Excellent!' : avgPainLevel < 3 ? 'Good progress' : 'Monitor closely'}
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="clockwork-card p-4 sm:p-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-lg font-semibold text-white">Circumference Measurements</h3>
                                        <button
                                            onClick={() => setShowCircumferenceChart(!showCircumferenceChart)}
                                            className="clockwork-button-secondary text-sm"
                                        >
                                            {showCircumferenceChart ? 'Hide Chart' : 'Show Chart'}
                                        </button>
                                    </div>
                                    
                                    {showCircumferenceChart && (
                                        <div style={{ height: '400px', marginTop: '1rem' }}>
                                            <canvas ref={circumferenceChartRef}></canvas>
                                        </div>
                                    )}
                                    
                                    {!showCircumferenceChart && latestMeasurement.circumference && (
                                        <div className="grid grid-cols-2 sm:grid-cols-3 gap-4">
                                            {Object.entries(latestMeasurement.circumference).map(([key, value]) => (
                                                <div key={key} className="text-center">
                                                    <p className="text-xs text-gray-400">{key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}</p>
                                                    <p className="text-lg font-semibold text-white">{value}"</p>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </>
                        )}
                    </div>
                );
            };

            // Measurements Component
            const Measurements = () => {
                const [showAddForm, setShowAddForm] = useState(false);
                const [newMeasurement, setNewMeasurement] = useState({
                    date: new Date().toISOString().split('T')[0],
                    weight: '',
                    bodyFat: '',
                    bloodPressure: '',
                    height: '',
                    age: '',
                    gender: 'male',
                    activityLevel: 'moderate',
                    calculateBMR: false,
                    circumference: {
                        neck: '',
                        shoulders: '',
                        chest: '',
                        upperArm: '',
                        lowerArm: '',
                        waist: '',
                        hips: '',
                        upperThigh: '',
                        calf: ''
                    },
                    caliper: {
                        chest: '',
                        abdominal: '',
                        thigh: '',
                        bicep: '',
                        tricep: '',
                        subscapular: '',
                        suprailiac: '',
                        lowerBack: '',
                        calf: ''
                    }
                });

                const clientToUse = hasRole('client') ? currentUser.id : selectedClient?.id;
                const myMeasurements = clientData.measurements.filter(m => m.clientId === clientToUse);

                const calculateBMR = () => {
                    const { weight, height, age, gender } = newMeasurement;
                    if (!weight || !height || !age || !newMeasurement.calculateBMR) return '';
                    
                    // Convert weight from lbs to kg
                    const weightKg = parseFloat(weight) * 0.453592;
                    // Convert height from inches to cm
                    const heightCm = parseFloat(height) * 2.54;
                    const ageNum = parseFloat(age);
                    
                    let bmr;
                    if (gender === 'male') {
                        bmr = 88.362 + (13.397 * weightKg) + (4.799 * heightCm) - (5.677 * ageNum);
                    } else {
                        bmr = 447.593 + (9.247 * weightKg) + (3.098 * heightCm) - (4.330 * ageNum);
                    }
                    
                    // Activity multiplier
                    const activityMultipliers = {
                        sedentary: 1.2,
                        light: 1.375,
                        moderate: 1.55,
                        active: 1.725,
                        veryActive: 1.9
                    };
                    
                    const tdee = bmr * activityMultipliers[newMeasurement.activityLevel];
                    return Math.round(tdee);
                };

                const handleSubmit = (e) => {
                    e.preventDefault();
                    if (!clientToUse) {
                        setError('Please select a client first');
                        return;
                    }
                    
                    const bmr = calculateBMR();
                    
                    const measurement = {
                        id: Date.now(),
                        clientId: clientToUse,
                        date: newMeasurement.date,
                        weight: parseFloat(newMeasurement.weight),
                        bodyFat: parseFloat(newMeasurement.bodyFat) || null,
                        bmr: bmr || parseFloat(newMeasurement.bmr) || null,
                        bloodPressure: newMeasurement.bloodPressure,
                        circumference: Object.fromEntries(
                            Object.entries(newMeasurement.circumference)
                                .filter(([_, v]) => v)
                                .map(([k, v]) => [k, parseFloat(v)])
                        ),
                        caliper: Object.fromEntries(
                            Object.entries(newMeasurement.caliper)
                                .filter(([_, v]) => v)
                                .map(([k, v]) => [k, parseFloat(v)])
                        ),
                        recordedBy: currentUser.id,
                        recordedAt: new Date().toISOString()
                    };
                    
                    setClientData(prev => ({
                        ...prev,
                        measurements: [...prev.measurements, measurement]
                    }));
                    
                    setSuccessMessage('Measurement recorded successfully!');
                    setShowAddForm(false);
                    setNewMeasurement({
                        date: new Date().toISOString().split('T')[0],
                        weight: '',
                        bodyFat: '',
                        bloodPressure: '',
                        height: '',
                        age: '',
                        gender: 'male',
                        activityLevel: 'moderate',
                        calculateBMR: false,
                        circumference: {
                            neck: '',
                            shoulders: '',
                            chest: '',
                            upperArm: '',
                            lowerArm: '',
                            waist: '',
                            hips: '',
                            upperThigh: '',
                            calf: ''
                        },
                        caliper: {
                            chest: '',
                            abdominal: '',
                            thigh: '',
                            bicep: '',
                            tricep: '',
                            subscapular: '',
                            suprailiac: '',
                            lowerBack: '',
                            calf: ''
                        }
                    });
                };

                return (
                    <div className="space-y-6">
                        <div className="clockwork-card p-4 sm:p-6">
                            <div className="flex justify-between items-center">
                                <h2 className="text-xl sm:text-2xl font-bold text-white">Measurements</h2>
                                <button 
                                    onClick={() => setShowAddForm(!showAddForm)}
                                    className="clockwork-button"
                                >
                                    <span className="mr-2">➕</span>
                                    Add Measurement
                                </button>
                            </div>
                            
                            {hasAnyRole('specialist', 'admin', 'owner') && (
                                <div className="mt-4">
                                    <select 
                                        onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                        className="clockwork-select max-w-xs"
                                        value={selectedClient?.id || ''}
                                    >
                                        <option value="">Select a client...</option>
                                        {getMyClients().map(client => (
                                            <option key={client.id} value={client.id}>{client.name}</option>
                                        ))}
                                    </select>
                                </div>
                            )}
                        </div>

                        {showAddForm && (
                            <div className="clockwork-card p-4 sm:p-6">
                                <h3 className="text-lg font-semibold mb-4 text-white">Record New Measurement</h3>
                                <form onSubmit={handleSubmit}>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <div className="form-group">
                                            <label className="form-label">Date</label>
                                            <input
                                                type="date"
                                                value={newMeasurement.date}
                                                onChange={(e) => setNewMeasurement(prev => ({ ...prev, date: e.target.value }))}
                                                className="clockwork-input"
                                                required
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Weight (lbs)</label>
                                            <input
                                                type="number"
                                                step="0.1"
                                                value={newMeasurement.weight}
                                                onChange={(e) => setNewMeasurement(prev => ({ ...prev, weight: e.target.value }))}
                                                className="clockwork-input"
                                                placeholder="165.5"
                                                required
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Body Fat %</label>
                                            <input
                                                type="number"
                                                step="0.1"
                                                value={newMeasurement.bodyFat}
                                                onChange={(e) => setNewMeasurement(prev => ({ ...prev, bodyFat: e.target.value }))}
                                                className="clockwork-input"
                                                placeholder="18.5"
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Blood Pressure</label>
                                            <input
                                                type="text"
                                                value={newMeasurement.bloodPressure}
                                                onChange={(e) => setNewMeasurement(prev => ({ ...prev, bloodPressure: e.target.value }))}
                                                className="clockwork-input"
                                                placeholder="120/80"
                                            />
                                        </div>
                                    </div>

                                    <div className="measurement-category">
                                        <h4>
                                            BMR Calculation
                                            <span className="bmr-toggle">
                                                <input
                                                    type="checkbox"
                                                    checked={newMeasurement.calculateBMR}
                                                    onChange={(e) => setNewMeasurement(prev => ({ ...prev, calculateBMR: e.target.checked }))}
                                                />
                                                <label>Calculate automatically</label>
                                            </span>
                                        </h4>
                                        
                                        {newMeasurement.calculateBMR ? (
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div className="form-group">
                                                    <label className="form-label">Height (inches)</label>
                                                    <input
                                                        type="number"
                                                        step="0.1"
                                                        value={newMeasurement.height}
                                                        onChange={(e) => setNewMeasurement(prev => ({ ...prev, height: e.target.value }))}
                                                        className="clockwork-input"
                                                        placeholder="70"
                                                    />
                                                </div>
                                                
                                                <div className="form-group">
                                                    <label className="form-label">Age</label>
                                                    <input
                                                        type="number"
                                                        value={newMeasurement.age}
                                                        onChange={(e) => setNewMeasurement(prev => ({ ...prev, age: e.target.value }))}
                                                        className="clockwork-input"
                                                        placeholder="35"
                                                    />
                                                </div>
                                                
                                                <div className="form-group">
                                                    <label className="form-label">Gender</label>
                                                    <select
                                                        value={newMeasurement.gender}
                                                        onChange={(e) => setNewMeasurement(prev => ({ ...prev, gender: e.target.value }))}
                                                        className="clockwork-select"
                                                    >
                                                        <option value="male">Male</option>
                                                        <option value="female">Female</option>
                                                    </select>
                                                </div>
                                                
                                                <div className="form-group">
                                                    <label className="form-label">Activity Level</label>
                                                    <select
                                                        value={newMeasurement.activityLevel}
                                                        onChange={(e) => setNewMeasurement(prev => ({ ...prev, activityLevel: e.target.value }))}
                                                        className="clockwork-select"
                                                    >
                                                        <option value="sedentary">Sedentary (little/no exercise)</option>
                                                        <option value="light">Light (1-3 days/week)</option>
                                                        <option value="moderate">Moderate (3-5 days/week)</option>
                                                        <option value="active">Active (6-7 days/week)</option>
                                                        <option value="veryActive">Very Active (2x per day)</option>
                                                    </select>
                                                </div>
                                                
                                                {newMeasurement.weight && newMeasurement.height && newMeasurement.age && (
                                                    <div className="col-span-full">
                                                        <p className="text-lg font-semibold text-green-400">
                                                            Calculated BMR: {calculateBMR()} calories/day
                                                        </p>
                                                    </div>
                                                )}
                                            </div>
                                        ) : (
                                            <div className="form-group">
                                                <label className="form-label">BMR (calories/day)</label>
                                                <input
                                                    type="number"
                                                    value={newMeasurement.bmr}
                                                    onChange={(e) => setNewMeasurement(prev => ({ ...prev, bmr: e.target.value }))}
                                                    className="clockwork-input"
                                                    placeholder="1650"
                                                />
                                            </div>
                                        )}
                                    </div>
                                    
                                    <div className="measurement-category">
                                        <h4>📏 Circumference Measurements (inches)</h4>
                                        <div className="measurement-grid">
                                            {Object.keys(newMeasurement.circumference).map(key => (
                                                <div key={key} className="measurement-input-group">
                                                    <label>{key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}</label>
                                                    <input
                                                        type="number"
                                                        step="0.1"
                                                        value={newMeasurement.circumference[key]}
                                                        onChange={(e) => setNewMeasurement(prev => ({
                                                            ...prev,
                                                            circumference: { ...prev.circumference, [key]: e.target.value }
                                                        }))}
                                                        placeholder="0.0"
                                                    />
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    <div className="measurement-category">
                                        <h4>📐 Caliper Measurements (mm)</h4>
                                        <div className="measurement-grid">
                                            {Object.keys(newMeasurement.caliper).map(key => (
                                                <div key={key} className="measurement-input-group">
                                                    <label>{key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}</label>
                                                    <input
                                                        type="number"
                                                        step="0.1"
                                                        value={newMeasurement.caliper[key]}
                                                        onChange={(e) => setNewMeasurement(prev => ({
                                                            ...prev,
                                                            caliper: { ...prev.caliper, [key]: e.target.value }
                                                        }))}
                                                        placeholder="0.0"
                                                    />
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    <div className="flex gap-2 mt-6">
                                        <button type="submit" className="clockwork-button">
                                            Save Measurement
                                        </button>
                                        <button 
                                            type="button" 
                                            onClick={() => setShowAddForm(false)}
                                            className="clockwork-button-secondary"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}

                        <div className="responsive-table">
                            <table className="min-w-full">
                                <thead>
                                    <tr>
                                        <th className="px-4 py-2 text-left">Date</th>
                                        <th className="px-4 py-2 text-left">Weight</th>
                                        <th className="px-4 py-2 text-left">Body Fat</th>
                                        <th className="px-4 py-2 text-left">BMR</th>
                                        <th className="px-4 py-2 text-left">Blood Pressure</th>
                                        <th className="px-4 py-2 text-left hide-mobile">Waist</th>
                                        <th className="px-4 py-2 text-left">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {myMeasurements.length === 0 ? (
                                        <tr>
                                            <td colSpan="7" className="text-center py-8">
                                                <div className="empty-state">
                                                    <div className="empty-state-icon">📏</div>
                                                    <div className="empty-state-title">No measurements yet</div>
                                                    <div className="empty-state-description">Start tracking your progress by adding your first measurement</div>
                                                </div>
                                            </td>
                                        </tr>
                                    ) : (
                                        myMeasurements.map(m => (
                                            <tr key={m.id}>
                                                <td className="px-4 py-2">{m.date}</td>
                                                <td className="px-4 py-2">{m.weight} lbs</td>
                                                <td className="px-4 py-2">{m.bodyFat ? `${m.bodyFat}%` : '-'}</td>
                                                <td className="px-4 py-2">{m.bmr || '-'}</td>
                                                <td className="px-4 py-2">{m.bloodPressure || '-'}</td>
                                                <td className="px-4 py-2 hide-mobile">{m.circumference?.waist ? `${m.circumference.waist}"` : '-'}</td>
                                                <td className="px-4 py-2">
                                                    <button 
                                                        onClick={() => {
                                                            if (confirm('Are you sure you want to delete this measurement?')) {
                                                                setClientData(prev => ({
                                                                    ...prev,
                                                                    measurements: prev.measurements.filter(measurement => measurement.id !== m.id)
                                                                }));
                                                                setSuccessMessage('Measurement deleted successfully');
                                                            }
                                                        }}
                                                        className="text-red-400 hover:text-red-300"
                                                    >
                                                        🗑️
                                                    </button>
                                                </td>
                                            </tr>
                                        ))
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            };

            // Nutrition Component
            const Nutrition = () => {
                const [editMode, setEditMode] = useState(false);
                const [nutritionData, setNutritionData] = useState({
                    protein: { target: 0, current: 0 },
                    carbs: { target: 0, current: 0 },
                    fat: { target: 0, current: 0 },
                    calories: { target: 0, current: 0 },
                    mealPlan: {
                        breakfast: '',
                        lunch: '',
                        dinner: '',
                        snacks: ''
                    }
                });

                const clientToUse = hasRole('client') ? currentUser.id : selectedClient?.id;
                const myNutrition = clientData.nutrition && clientData.nutrition.clientId === clientToUse ? clientData.nutrition : null;

                useEffect(() => {
                    if (myNutrition) {
                        setNutritionData(myNutrition);
                    }
                }, [myNutrition, clientToUse]);

                const handleSave = () => {
                    if (!clientToUse) {
                        setError('Please select a client first');
                        return;
                    }

                    const nutritionUpdate = {
                        ...nutritionData,
                        clientId: clientToUse,
                        assignedBy: currentUser.id,
                        lastUpdated: new Date().toISOString()
                    };

                    setClientData(prev => ({
                        ...prev,
                        nutrition: nutritionUpdate
                    }));

                    setEditMode(false);
                    setSuccessMessage('Nutrition plan updated successfully!');
                };

                const calculatePercentage = (current, target) => {
                    if (!target) return 0;
                    return Math.min(100, Math.round((current / target) * 100));
                };

                return (
                    <div className="space-y-6">
                        <div className="clockwork-card p-4 sm:p-6">
                            <div className="flex justify-between items-center">
                                <h2 className="text-xl sm:text-2xl font-bold text-white">Nutrition Plan</h2>
                                {hasAnyRole('specialist', 'admin', 'owner') && (
                                    <button 
                                        onClick={() => setEditMode(!editMode)}
                                        className="clockwork-button"
                                    >
                                        {editMode ? '💾 Save' : '✏️ Edit'}
                                    </button>
                                )}
                            </div>
                            
                            {hasAnyRole('specialist', 'admin', 'owner') && (
                                <div className="mt-4">
                                    <select 
                                        onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                        className="clockwork-select max-w-xs"
                                        value={selectedClient?.id || ''}
                                    >
                                        <option value="">Select a client...</option>
                                        {getMyClients().map(client => (
                                            <option key={client.id} value={client.id}>{client.name}</option>
                                        ))}
                                    </select>
                                </div>
                            )}
                        </div>

                        {(hasRole('client') || selectedClient) && (
                            <>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div className="clockwork-card p-4">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-2xl">🥩</span>
                                            <h3 className="font-semibold text-white">Protein</h3>
                                        </div>
                                        {editMode ? (
                                            <div className="space-y-2">
                                                <input
                                                    type="number"
                                                    placeholder="Target (g)"
                                                    value={nutritionData.protein.target}
                                                    onChange={(e) => setNutritionData(prev => ({
                                                        ...prev,
                                                        protein: { ...prev.protein, target: parseInt(e.target.value) || 0 }
                                                    }))}
                                                    className="clockwork-input"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Current (g)"
                                                    value={nutritionData.protein.current}
                                                    onChange={(e) => setNutritionData(prev => ({
                                                        ...prev,
                                                        protein: { ...prev.protein, current: parseInt(e.target.value) || 0 }
                                                    }))}
                                                    className="clockwork-input"
                                                />
                                            </div>
                                        ) : (
                                            <>
                                                <p className="text-2xl font-bold text-blue-400">
                                                    {nutritionData.protein.current}g / {nutritionData.protein.target}g
                                                </p>
                                                <div className="progress-bar mt-2">
                                                    <div 
                                                        className="progress-fill" 
                                                        style={{ width: `${calculatePercentage(nutritionData.protein.current, nutritionData.protein.target)}%` }}
                                                    ></div>
                                                </div>
                                                <p className="text-xs text-gray-400 mt-1">
                                                    {calculatePercentage(nutritionData.protein.current, nutritionData.protein.target)}% of daily goal
                                                </p>
                                            </>
                                        )}
                                    </div>

                                    <div className="clockwork-card p-4">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-2xl">🌾</span>
                                            <h3 className="font-semibold text-white">Carbs</h3>
                                        </div>
                                        {editMode ? (
                                            <div className="space-y-2">
                                                <input
                                                    type="number"
                                                    placeholder="Target (g)"
                                                    value={nutritionData.carbs.target}
                                                    onChange={(e) => setNutritionData(prev => ({
                                                        ...prev,
                                                        carbs: { ...prev.carbs, target: parseInt(e.target.value) || 0 }
                                                    }))}
                                                    className="clockwork-input"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Current (g)"
                                                    value={nutritionData.carbs.current}
                                                    onChange={(e) => setNutritionData(prev => ({
                                                        ...prev,
                                                        carbs: { ...prev.carbs, current: parseInt(e.target.value) || 0 }
                                                    }))}
                                                    className="clockwork-input"
                                                />
                                            </div>
                                        ) : (
                                            <>
                                                <p className="text-2xl font-bold text-amber-400">
                                                    {nutritionData.carbs.current}g / {nutritionData.carbs.target}g
                                                </p>
                                                <div className="progress-bar mt-2">
                                                    <div 
                                                        className="progress-fill" 
                                                        style={{ width: `${calculatePercentage(nutritionData.carbs.current, nutritionData.carbs.target)}%` }}
                                                    ></div>
                                                </div>
                                                <p className="text-xs text-gray-400 mt-1">
                                                    {calculatePercentage(nutritionData.carbs.current, nutritionData.carbs.target)}% of daily goal
                                                </p>
                                            </>
                                        )}
                                    </div>

                                    <div className="clockwork-card p-4">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-2xl">🥑</span>
                                            <h3 className="font-semibold text-white">Fat</h3>
                                        </div>
                                        {editMode ? (
                                            <div className="space-y-2">
                                                <input
                                                    type="number"
                                                    placeholder="Target (g)"
                                                    value={nutritionData.fat.target}
                                                    onChange={(e) => setNutritionData(prev => ({
                                                        ...prev,
                                                        fat: { ...prev.fat, target: parseInt(e.target.value) || 0 }
                                                    }))}
                                                    className="clockwork-input"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Current (g)"
                                                    value={nutritionData.fat.current}
                                                    onChange={(e) => setNutritionData(prev => ({
                                                        ...prev,
                                                        fat: { ...prev.fat, current: parseInt(e.target.value) || 0 }
                                                    }))}
                                                    className="clockwork-input"
                                                />
                                            </div>
                                        ) : (
                                            <>
                                                <p className="text-2xl font-bold text-green-400">
                                                    {nutritionData.fat.current}g / {nutritionData.fat.target}g
                                                </p>
                                                <div className="progress-bar mt-2">
                                                    <div 
                                                        className="progress-fill" 
                                                        style={{ width: `${calculatePercentage(nutritionData.fat.current, nutritionData.fat.target)}%` }}
                                                    ></div>
                                                </div>
                                                <p className="text-xs text-gray-400 mt-1">
                                                    {calculatePercentage(nutritionData.fat.current, nutritionData.fat.target)}% of daily goal
                                                </p>
                                            </>
                                        )}
                                    </div>

                                    <div className="clockwork-card p-4">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-2xl">🔥</span>
                                            <h3 className="font-semibold text-white">Calories</h3>
                                        </div>
                                        {editMode ? (
                                            <div className="space-y-2">
                                                <input
                                                    type="number"
                                                    placeholder="Target"
                                                    value={nutritionData.calories.target}
                                                    onChange={(e) => setNutritionData(prev => ({
                                                        ...prev,
                                                        calories: { ...prev.calories, target: parseInt(e.target.value) || 0 }
                                                    }))}
                                                    className="clockwork-input"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Current"
                                                    value={nutritionData.calories.current}
                                                    onChange={(e) => setNutritionData(prev => ({
                                                        ...prev,
                                                        calories: { ...prev.calories, current: parseInt(e.target.value) || 0 }
                                                    }))}
                                                    className="clockwork-input"
                                                />
                                            </div>
                                        ) : (
                                            <>
                                                <p className="text-2xl font-bold text-red-400">
                                                    {nutritionData.calories.current} / {nutritionData.calories.target}
                                                </p>
                                                <div className="progress-bar mt-2">
                                                    <div 
                                                        className="progress-fill" 
                                                        style={{ width: `${calculatePercentage(nutritionData.calories.current, nutritionData.calories.target)}%` }}
                                                    ></div>
                                                </div>
                                                <p className="text-xs text-gray-400 mt-1">
                                                    {calculatePercentage(nutritionData.calories.current, nutritionData.calories.target)}% of daily goal
                                                </p>
                                            </>
                                        )}
                                    </div>
                                </div>

                                <div className="clockwork-card p-4 sm:p-6">
                                    <h3 className="text-lg font-semibold mb-4 text-white">Daily Meal Plan</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <h4 className="font-medium mb-2 flex items-center gap-2 text-white">
                                                <span>🌅</span> Breakfast
                                            </h4>
                                            {editMode ? (
                                                <textarea
                                                    value={nutritionData.mealPlan.breakfast}
                                                    onChange={(e) => setNutritionData(prev => ({
                                                        ...prev,
                                                        mealPlan: { ...prev.mealPlan, breakfast: e.target.value }
                                                    }))}
                                                    className="clockwork-input"
                                                    rows="3"
                                                    placeholder="Enter breakfast plan..."
                                                />
                                            ) : (
                                                <p className="text-gray-300">{nutritionData.mealPlan.breakfast || 'No plan set'}</p>
                                            )}
                                        </div>

                                        <div>
                                            <h4 className="font-medium mb-2 flex items-center gap-2 text-white">
                                                <span>☀️</span> Lunch
                                            </h4>
                                            {editMode ? (
                                                <textarea
                                                    value={nutritionData.mealPlan.lunch}
                                                    onChange={(e) => setNutritionData(prev => ({
                                                        ...prev,
                                                        mealPlan: { ...prev.mealPlan, lunch: e.target.value }
                                                    }))}
                                                    className="clockwork-input"
                                                    rows="3"
                                                    placeholder="Enter lunch plan..."
                                                />
                                            ) : (
                                                <p className="text-gray-300">{nutritionData.mealPlan.lunch || 'No plan set'}</p>
                                            )}
                                        </div>

                                        <div>
                                            <h4 className="font-medium mb-2 flex items-center gap-2 text-white">
                                                <span>🌙</span> Dinner
                                            </h4>
                                            {editMode ? (
                                                <textarea
                                                    value={nutritionData.mealPlan.dinner}
                                                    onChange={(e) => setNutritionData(prev => ({
                                                        ...prev,
                                                        mealPlan: { ...prev.mealPlan, dinner: e.target.value }
                                                    }))}
                                                    className="clockwork-input"
                                                    rows="3"
                                                    placeholder="Enter dinner plan..."
                                                />
                                            ) : (
                                                <p className="text-gray-300">{nutritionData.mealPlan.dinner || 'No plan set'}</p>
                                            )}
                                        </div>

                                        <div>
                                            <h4 className="font-medium mb-2 flex items-center gap-2 text-white">
                                                <span>🍎</span> Snacks
                                            </h4>
                                            {editMode ? (
                                                <textarea
                                                    value={nutritionData.mealPlan.snacks}
                                                    onChange={(e) => setNutritionData(prev => ({
                                                        ...prev,
                                                        mealPlan: { ...prev.mealPlan, snacks: e.target.value }
                                                    }))}
                                                    className="clockwork-input"
                                                    rows="3"
                                                    placeholder="Enter snacks plan..."
                                                />
                                            ) : (
                                                <p className="text-gray-300">{nutritionData.mealPlan.snacks || 'No plan set'}</p>
                                            )}
                                        </div>
                                    </div>

                                    {editMode && (
                                        <div className="flex gap-2 mt-6">
                                            <button onClick={handleSave} className="clockwork-button">
                                                Save Nutrition Plan
                                            </button>
                                            <button 
                                                onClick={() => {
                                                    setEditMode(false);
                                                    if (myNutrition) {
                                                        setNutritionData(myNutrition);
                                                    }
                                                }}
                                                className="clockwork-button-secondary"
                                            >
                                                Cancel
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </>
                        )}
                    </div>
                );
            };

            // Workouts Component
            const Workouts = () => {
                const [showAssignForm, setShowAssignForm] = useState(false);
                const [selectedWorkout, setSelectedWorkout] = useState(null);
                const [showCompletionModal, setShowCompletionModal] = useState(false);
                const [completionData, setCompletionData] = useState({
                    exercises: [],
                    moodFeedback: 3,
                    notes: ''
                });
                const [newWorkout, setNewWorkout] = useState({
                    name: '',
                    exercises: [{ name: '', sets: '', reps: '', weight: '', specialistNote: '' }],
                    youtubeLink: '',
                    exerciseImage: null
                });

                const clientToUse = hasRole('client') ? currentUser.id : selectedClient?.id;
                const myWorkouts = clientData.workouts.filter(w => w.clientId === clientToUse);

                const handleAssignWorkout = () => {
                    if (!clientToUse) {
                        setError('Please select a client first');
                        return;
                    }

                    const workout = {
                        id: Date.now(),
                        clientId: clientToUse,
                        assignedBy: currentUser.id,
                        name: newWorkout.name,
                        exercises: newWorkout.exercises.filter(e => e.name).map((e, index) => ({
                            id: index + 1,
                            name: e.name,
                            sets: parseInt(e.sets) || 0,
                            reps: parseInt(e.reps) || 0,
                            weight: parseInt(e.weight) || 0,
                            specialistNote: e.specialistNote
                        })),
                        youtubeLink: newWorkout.youtubeLink,
                        exerciseImage: newWorkout.exerciseImage,
                        completed: false,
                        assignedDate: new Date().toISOString()
                    };

                    setClientData(prev => ({
                        ...prev,
                        workouts: [...prev.workouts, workout]
                    }));

                    setNewWorkout({
                        name: '',
                        exercises: [{ name: '', sets: '', reps: '', weight: '', specialistNote: '' }],
                        youtubeLink: '',
                        exerciseImage: null
                    });
                    setShowAssignForm(false);
                    setSuccessMessage('Workout assigned successfully!');
                };

                const handleCompleteWorkout = () => {
                    const updatedWorkout = {
                        ...selectedWorkout,
                        completed: true,
                        completedDate: new Date().toISOString(),
                        moodFeedback: completionData.moodFeedback,
                        notes: completionData.notes,
                        exercises: selectedWorkout.exercises.map((exercise, index) => ({
                            ...exercise,
                            actualSets: completionData.exercises[index]?.actualSets || exercise.sets,
                            actualReps: completionData.exercises[index]?.actualReps || exercise.reps,
                            actualWeight: completionData.exercises[index]?.actualWeight || exercise.weight,
                            painLevel: completionData.exercises[index]?.painLevel || 0
                        }))
                    };

                    setClientData(prev => ({
                        ...prev,
                        workouts: prev.workouts.map(w => w.id === selectedWorkout.id ? updatedWorkout : w)
                    }));

                    setShowCompletionModal(false);
                    setSelectedWorkout(null);
                    setCompletionData({ exercises: [], moodFeedback: 3, notes: '' });
                    setSuccessMessage('Workout completed! Great job! 💪');
                };

                const handleImageUpload = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onloadend = () => {
                            setNewWorkout(prev => ({ ...prev, exerciseImage: reader.result }));
                        };
                        reader.readAsDataURL(file);
                    }
                };

                return (
                    <div className="space-y-6">
                        <div className="clockwork-card p-4 sm:p-6">
                            <div className="flex justify-between items-center">
                                <h2 className="text-xl sm:text-2xl font-bold text-white">Workouts</h2>
                                {hasAnyRole('specialist', 'admin', 'owner') && (
                                    <button 
                                        onClick={() => setShowAssignForm(!showAssignForm)}
                                        className="clockwork-button"
                                    >
                                        <span className="mr-2">➕</span>
                                        Assign Workout
                                    </button>
                                )}
                            </div>
                            
                            {hasAnyRole('specialist', 'admin', 'owner') && (
                                <div className="mt-4">
                                    <select 
                                        onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                        className="clockwork-select max-w-xs"
                                        value={selectedClient?.id || ''}
                                    >
                                        <option value="">Select a client...</option>
                                        {getMyClients().map(client => (
                                            <option key={client.id} value={client.id}>{client.name}</option>
                                        ))}
                                    </select>
                                </div>
                            )}
                        </div>

                        {showAssignForm && (
                            <div className="assignment-form">
                                <div className="assignment-header">
                                    <span>💪</span>
                                    Assign New Workout
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Workout Name</label>
                                    <input
                                        type="text"
                                        value={newWorkout.name}
                                        onChange={(e) => setNewWorkout(prev => ({ ...prev, name: e.target.value }))}
                                        className="clockwork-input"
                                        placeholder="Upper Body Strength"
                                        required
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">YouTube Link (optional)</label>
                                    <input
                                        type="url"
                                        value={newWorkout.youtubeLink}
                                        onChange={(e) => setNewWorkout(prev => ({ ...prev, youtubeLink: e.target.value }))}
                                        className="clockwork-input"
                                        placeholder="https://www.youtube.com/watch?v=..."
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Exercise Image (optional)</label>
                                    <div className="workout-image-upload">
                                        {newWorkout.exerciseImage ? (
                                            <img src={newWorkout.exerciseImage} alt="Exercise" className="workout-image-preview" />
                                        ) : (
                                            <>
                                                <span className="text-2xl">📷</span>
                                                <p className="text-xs text-gray-400 mt-2">Click to upload</p>
                                            </>
                                        )}
                                        <input type="file" accept="image/*" onChange={handleImageUpload} />
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    <h4 className="font-semibold text-white">Exercises</h4>
                                    {newWorkout.exercises.map((exercise, index) => (
                                        <div key={index} className="exercise-card">
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-2">
                                                <input
                                                    type="text"
                                                    placeholder="Exercise name"
                                                    value={exercise.name}
                                                    onChange={(e) => {
                                                        const newExercises = [...newWorkout.exercises];
                                                        newExercises[index].name = e.target.value;
                                                        setNewWorkout(prev => ({ ...prev, exercises: newExercises }));
                                                    }}
                                                    className="clockwork-input"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Sets"
                                                    value={exercise.sets}
                                                    onChange={(e) => {
                                                        const newExercises = [...newWorkout.exercises];
                                                        newExercises[index].sets = e.target.value;
                                                        setNewWorkout(prev => ({ ...prev, exercises: newExercises }));
                                                    }}
                                                    className="clockwork-input"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Reps"
                                                    value={exercise.reps}
                                                    onChange={(e) => {
                                                        const newExercises = [...newWorkout.exercises];
                                                        newExercises[index].reps = e.target.value;
                                                        setNewWorkout(prev => ({ ...prev, exercises: newExercises }));
                                                    }}
                                                    className="clockwork-input"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Weight (lbs)"
                                                    value={exercise.weight}
                                                    onChange={(e) => {
                                                        const newExercises = [...newWorkout.exercises];
                                                        newExercises[index].weight = e.target.value;
                                                        setNewWorkout(prev => ({ ...prev, exercises: newExercises }));
                                                    }}
                                                    className="clockwork-input"
                                                />
                                            </div>
                                            <input
                                                type="text"
                                                placeholder="Specialist note (optional)"
                                                value={exercise.specialistNote}
                                                onChange={(e) => {
                                                    const newExercises = [...newWorkout.exercises];
                                                    newExercises[index].specialistNote = e.target.value;
                                                    setNewWorkout(prev => ({ ...prev, exercises: newExercises }));
                                                }}
                                                className="clockwork-input mt-2"
                                            />
                                            {newWorkout.exercises.length > 1 && (
                                                <button
                                                    onClick={() => {
                                                        const newExercises = newWorkout.exercises.filter((_, i) => i !== index);
                                                        setNewWorkout(prev => ({ ...prev, exercises: newExercises }));
                                                    }}
                                                    className="text-red-400 hover:text-red-300 mt-2"
                                                >
                                                    Remove Exercise
                                                </button>
                                            )}
                                        </div>
                                    ))}
                                    
                                    <button
                                        onClick={() => setNewWorkout(prev => ({
                                            ...prev,
                                            exercises: [...prev.exercises, { name: '', sets: '', reps: '', weight: '', specialistNote: '' }]
                                        }))}
                                        className="clockwork-button-secondary"
                                    >
                                        Add Exercise
                                    </button>
                                </div>

                                <div className="flex gap-2 mt-6">
                                    <button onClick={handleAssignWorkout} className="clockwork-button">
                                        Assign Workout
                                    </button>
                                    <button onClick={() => setShowAssignForm(false)} className="clockwork-button-secondary">
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        )}

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {myWorkouts.length === 0 ? (
                                <div className="col-span-full">
                                    <div className="empty-state">
                                        <div className="empty-state-icon">💪</div>
                                        <div className="empty-state-title">No workouts assigned yet</div>
                                        <div className="empty-state-description">
                                            {hasRole('client') ? 'Your trainer will assign workouts soon' : 'Assign a workout to get started'}
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                myWorkouts.map(workout => (
                                    <div key={workout.id} className="clockwork-card p-4">
                                        <div className="flex justify-between items-start mb-3">
                                            <h3 className="font-semibold text-lg text-white">{workout.name}</h3>
                                            {workout.completed ? (
                                                <span className="clockwork-badge badge-specialist">Completed</span>
                                            ) : (
                                                <span className="clockwork-badge badge-client">Pending</span>
                                            )}
                                        </div>
                                        
                                        {workout.exerciseImage && (
                                            <img 
                                                src={workout.exerciseImage} 
                                                alt="Exercise demonstration" 
                                                className="w-full h-32 object-cover rounded-lg mb-3"
                                            />
                                        )}
                                        
                                        <div className="space-y-2 mb-4">
                                            {workout.exercises.map(exercise => (
                                                <div key={exercise.id} className="text-sm">
                                                    <div className="flex justify-between items-center">
                                                        <span className="text-gray-300">{exercise.name}</span>
                                                        <span className="text-gray-400">
                                                            {exercise.sets} × {exercise.reps}
                                                            {exercise.weight > 0 && ` @ ${exercise.weight}lbs`}
                                                        </span>
                                                    </div>
                                                    {exercise.specialistNote && (
                                                        <div className="specialist-note text-xs mt-1">
                                                            💡 {exercise.specialistNote}
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>

                                        {workout.youtubeLink && (
                                            <a 
                                                href={workout.youtubeLink} 
                                                target="_blank" 
                                                rel="noopener noreferrer"
                                                className="clockwork-button-secondary text-sm mb-3 inline-flex"
                                            >
                                                <span className="mr-2">📹</span>
                                                Watch Demo
                                            </a>
                                        )}

                                        {!workout.completed && hasRole('client') && (
                                            <button 
                                                onClick={() => {
                                                    setSelectedWorkout(workout);
                                                    setCompletionData({
                                                        exercises: workout.exercises.map(e => ({
                                                            actualSets: e.sets,
                                                            actualReps: e.reps,
                                                            actualWeight: e.weight,
                                                            painLevel: 0
                                                        })),
                                                        moodFeedback: 3,
                                                        notes: ''
                                                    });
                                                    setShowCompletionModal(true);
                                                }}
                                                className="clockwork-button-success w-full"
                                            >
                                                Complete Workout
                                            </button>
                                        )}

                                        {workout.completed && (
                                            <div className="mt-3 pt-3 border-t border-gray-700">
                                                <p className="text-xs text-gray-400">
                                                    Completed: {new Date(workout.completedDate).toLocaleDateString()}
                                                </p>
                                                {workout.moodFeedback && (
                                                    <p className="text-xs text-gray-400">
                                                        Mood: {'😄'.repeat(workout.moodFeedback) + '😐'.repeat(5 - workout.moodFeedback)}
                                                    </p>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                ))
                            )}
                        </div>

                        {/* Workout Completion Modal */}
                        {showCompletionModal && selectedWorkout && (
                            <div className="modal-overlay" onClick={() => setShowCompletionModal(false)}>
                                <div className="modal-content max-w-2xl" onClick={(e) => e.stopPropagation()}>
                                    <h3 className="text-xl font-semibold mb-4 text-white">Complete Workout: {selectedWorkout.name}</h3>
                                    
                                    <div className="space-y-4 mb-6">
                                        {selectedWorkout.exercises.map((exercise, index) => (
                                            <div key={exercise.id} className="clockwork-card p-4">
                                                <h4 className="font-medium mb-3 text-white">{exercise.name}</h4>
                                                <div className="grid grid-cols-3 gap-2 mb-3">
                                                    <div>
                                                        <label className="text-xs text-gray-400">Actual Sets</label>
                                                        <input
                                                            type="number"
                                                            value={completionData.exercises[index]?.actualSets || ''}
                                                            onChange={(e) => {
                                                                const newExercises = [...completionData.exercises];
                                                                newExercises[index] = {
                                                                    ...newExercises[index],
                                                                    actualSets: parseInt(e.target.value) || 0
                                                                };
                                                                setCompletionData(prev => ({ ...prev, exercises: newExercises }));
                                                            }}
                                                            className="clockwork-input"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="text-xs text-gray-400">Actual Reps</label>
                                                        <input
                                                            type="number"
                                                            value={completionData.exercises[index]?.actualReps || ''}
                                                            onChange={(e) => {
                                                                const newExercises = [...completionData.exercises];
                                                                newExercises[index] = {
                                                                    ...newExercises[index],
                                                                    actualReps: parseInt(e.target.value) || 0
                                                                };
                                                                setCompletionData(prev => ({ ...prev, exercises: newExercises }));
                                                            }}
                                                            className="clockwork-input"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="text-xs text-gray-400">Weight (lbs)</label>
                                                        <input
                                                            type="number"
                                                            value={completionData.exercises[index]?.actualWeight || ''}
                                                            onChange={(e) => {
                                                                const newExercises = [...completionData.exercises];
                                                                newExercises[index] = {
                                                                    ...newExercises[index],
                                                                    actualWeight: parseInt(e.target.value) || 0
                                                                };
                                                                setCompletionData(prev => ({ ...prev, exercises: newExercises }));
                                                            }}
                                                            className="clockwork-input"
                                                        />
                                                    </div>
                                                </div>
                                                <div>
                                                    <label className="text-xs text-gray-400">Pain Level</label>
                                                    <div className="flex gap-2 mt-1">
                                                        {[0, 1, 2, 3, 4, 5].map(level => (
                                                            <button
                                                                key={level}
                                                                onClick={() => {
                                                                    const newExercises = [...completionData.exercises];
                                                                    newExercises[index] = {
                                                                        ...newExercises[index],
                                                                        painLevel: level
                                                                    };
                                                                    setCompletionData(prev => ({ ...prev, exercises: newExercises }));
                                                                }}
                                                                className={`pain-scale-btn pain-${level} ${completionData.exercises[index]?.painLevel === level ? 'selected' : ''}`}
                                                            >
                                                                {level}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">How are you feeling?</label>
                                        <div className="flex gap-3">
                                            {[1, 2, 3, 4, 5].map(mood => (
                                                <button
                                                    key={mood}
                                                    onClick={() => setCompletionData(prev => ({ ...prev, moodFeedback: mood }))}
                                                    className={`mood-btn ${completionData.moodFeedback === mood ? 'selected' : ''}`}
                                                >
                                                    {mood === 1 && '😞'}
                                                    {mood === 2 && '😕'}
                                                    {mood === 3 && '😐'}
                                                    {mood === 4 && '😊'}
                                                    {mood === 5 && '😄'}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Notes (optional)</label>
                                        <textarea
                                            value={completionData.notes}
                                            onChange={(e) => setCompletionData(prev => ({ ...prev, notes: e.target.value }))}
                                            className="clockwork-input"
                                            rows="3"
                                            placeholder="How did the workout go? Any concerns?"
                                        />
                                    </div>

                                    <div className="flex gap-2">
                                        <button onClick={handleCompleteWorkout} className="clockwork-button-success">
                                            Complete Workout
                                        </button>
                                        <button onClick={() => setShowCompletionModal(false)} className="clockwork-button-secondary">
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Goals Component
            const Goals = () => {
                const [showAddForm, setShowAddForm] = useState(false);
                const [newGoal, setNewGoal] = useState({
                    name: '',
                    target: '',
                    current: '',
                    deadline: ''
                });

                const clientToUse = hasRole('client') ? currentUser.id : selectedClient?.id;
                const myGoals = clientData.goals.filter(g => g.clientId === clientToUse);

                const handleAddGoal = (e) => {
                    e.preventDefault();
                    if (!clientToUse) {
                        setError('Please select a client first');
                        return;
                    }

                    const goal = {
                        id: Date.now(),
                        clientId: clientToUse,
                        assignedBy: currentUser.id,
                        name: newGoal.name,
                        target: parseFloat(newGoal.target),
                        current: parseFloat(newGoal.current),
                        deadline: newGoal.deadline,
                        createdAt: new Date().toISOString()
                    };

                    setClientData(prev => ({
                        ...prev,
                        goals: [...prev.goals, goal]
                    }));

                    setNewGoal({ name: '', target: '', current: '', deadline: '' });
                    setShowAddForm(false);
                    setSuccessMessage('Goal added successfully!');
                };

                const updateGoalProgress = (goalId, newCurrent) => {
                    setClientData(prev => ({
                        ...prev,
                        goals: prev.goals.map(g => 
                            g.id === goalId ? { ...g, current: parseFloat(newCurrent) } : g
                        )
                    }));
                    setSuccessMessage('Goal progress updated!');
                };

                const deleteGoal = (goalId) => {
                    if (confirm('Are you sure you want to delete this goal?')) {
                        setClientData(prev => ({
                            ...prev,
                            goals: prev.goals.filter(g => g.id !== goalId)
                        }));
                        setSuccessMessage('Goal deleted successfully');
                    }
                };

                return (
                    <div className="space-y-6">
                        <div className="clockwork-card p-4 sm:p-6">
                            <div className="flex justify-between items-center">
                                <h2 className="text-xl sm:text-2xl font-bold text-white">Goals & Targets</h2>
                                <button 
                                    onClick={() => setShowAddForm(!showAddForm)}
                                    className="clockwork-button"
                                >
                                    <span className="mr-2">➕</span>
                                    Add Goal
                                </button>
                            </div>
                            
                            {hasAnyRole('specialist', 'admin', 'owner') && (
                                <div className="mt-4">
                                    <select 
                                        onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                        className="clockwork-select max-w-xs"
                                        value={selectedClient?.id || ''}
                                    >
                                        <option value="">Select a client...</option>
                                        {getMyClients().map(client => (
                                            <option key={client.id} value={client.id}>{client.name}</option>
                                        ))}
                                    </select>
                                </div>
                            )}
                        </div>

                        {showAddForm && (
                            <div className="clockwork-card p-4 sm:p-6">
                                <h3 className="text-lg font-semibold mb-4 text-white">Set New Goal</h3>
                                <form onSubmit={handleAddGoal}>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="form-group md:col-span-2">
                                            <label className="form-label">Goal Name</label>
                                            <input
                                                type="text"
                                                value={newGoal.name}
                                                onChange={(e) => setNewGoal(prev => ({ ...prev, name: e.target.value }))}
                                                className="clockwork-input"
                                                placeholder="Weight Loss Goal"
                                                required
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Current Value</label>
                                            <input
                                                type="number"
                                                step="0.1"
                                                value={newGoal.current}
                                                onChange={(e) => setNewGoal(prev => ({ ...prev, current: e.target.value }))}
                                                className="clockwork-input"
                                                placeholder="165"
                                                required
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Target Value</label>
                                            <input
                                                type="number"
                                                step="0.1"
                                                value={newGoal.target}
                                                onChange={(e) => setNewGoal(prev => ({ ...prev, target: e.target.value }))}
                                                className="clockwork-input"
                                                placeholder="155"
                                                required
                                            />
                                        </div>
                                        
                                        <div className="form-group md:col-span-2">
                                            <label className="form-label">Target Date</label>
                                            <input
                                                type="date"
                                                value={newGoal.deadline}
                                                onChange={(e) => setNewGoal(prev => ({ ...prev, deadline: e.target.value }))}
                                                className="clockwork-input"
                                                required
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="flex gap-2 mt-4">
                                        <button type="submit" className="clockwork-button">
                                            Create Goal
                                        </button>
                                        <button 
                                            type="button" 
                                            onClick={() => setShowAddForm(false)}
                                            className="clockwork-button-secondary"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {myGoals.length === 0 ? (
                                <div className="col-span-full">
                                    <div className="empty-state">
                                        <div className="empty-state-icon">🎯</div>
                                        <div className="empty-state-title">No goals set yet</div>
                                        <div className="empty-state-description">Set your first goal to start tracking progress</div>
                                    </div>
                                </div>
                            ) : (
                                myGoals.map(goal => {
                                    const progress = Math.min(100, Math.round((goal.current / goal.target) * 100));
                                    const daysLeft = Math.ceil((new Date(goal.deadline) - new Date()) / (1000 * 60 * 60 * 24));
                                    const isOverdue = daysLeft < 0;
                                    
                                    return (
                                        <div key={goal.id} className="clockwork-card p-4 sm:p-6">
                                            <div className="flex justify-between items-start mb-4">
                                                <h3 className="font-semibold text-lg text-white">{goal.name}</h3>
                                                <button 
                                                    onClick={() => deleteGoal(goal.id)}
                                                    className="text-red-400 hover:text-red-300"
                                                >
                                                    🗑️
                                                </button>
                                            </div>
                                            
                                            <div className="mb-4">
                                                <div className="flex justify-between text-sm mb-2">
                                                    <span className="text-gray-400">Current: {goal.current}</span>
                                                    <span className="text-gray-400">Target: {goal.target}</span>
                                                </div>
                                                <div className="progress-bar" style={{ height: '12px' }}>
                                                    <div 
                                                        className="progress-fill" 
                                                        style={{ width: `${progress}%` }}
                                                    ></div>
                                                </div>
                                                <p className="text-center mt-2 text-lg font-bold text-blue-400">{progress}%</p>
                                            </div>
                                            
                                            <div className="text-sm text-gray-400 mb-4">
                                                {isOverdue ? (
                                                    <span className="text-red-400">Overdue by {Math.abs(daysLeft)} days</span>
                                                ) : (
                                                    <span>{daysLeft} days remaining</span>
                                                )}
                                                <br />
                                                Deadline: {new Date(goal.deadline).toLocaleDateString()}
                                            </div>
                                            
                                            {hasRole('client') && (
                                                <div className="flex gap-2">
                                                    <input
                                                        type="number"
                                                        step="0.1"
                                                        placeholder="Update progress"
                                                        className="clockwork-input flex-1"
                                                        onKeyPress={(e) => {
                                                            if (e.key === 'Enter' && e.target.value) {
                                                                updateGoalProgress(goal.id, e.target.value);
                                                                e.target.value = '';
                                                            }
                                                        }}
                                                    />
                                                    <button 
                                                        onClick={(e) => {
                                                            const input = e.target.previousSibling;
                                                            if (input.value) {
                                                                updateGoalProgress(goal.id, input.value);
                                                                input.value = '';
                                                            }
                                                        }}
                                                        className="clockwork-button"
                                                    >
                                                        Update
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })
                            )}
                        </div>
                    </div>
                );
            };

            // Chat Component
            const Chat = () => {
                const [activeChat, setActiveChat] = useState(null);
                const [messageText, setMessageText] = useState('');
                const [searchTerm, setSearchTerm] = useState('');
                const [showTyping, setShowTyping] = useState(false);
                const messagesEndRef = useRef(null);
                const [showMobileChat, setShowMobileChat] = useState(false);

                const getChatPartners = () => {
                    if (hasRole('client')) {
                        // Clients can chat with their specialists
                        return allUsers.filter(u => 
                            currentUser.specialistIds?.includes(u.id) || 
                            u.roles.includes('admin') || 
                            u.roles.includes('owner')
                        );
                    } else {
                        // Specialists can chat with their clients and other staff
                        const clients = getMyClients();
                        const staff = allUsers.filter(u => 
                            u.roles.includes('specialist') || 
                            u.roles.includes('admin') || 
                            u.roles.includes('owner')
                        );
                        return [...clients, ...staff.filter(s => s.id !== currentUser.id)];
                    }
                };

                const chatPartners = getChatPartners().filter(partner => 
                    partner.name.toLowerCase().includes(searchTerm.toLowerCase())
                );

                const getChatKey = (partnerId) => {
                    const ids = [currentUser.id, partnerId].sort();
                    return `${ids[0]}-${ids[1]}`;
                };

                const getMessages = (partnerId) => {
                    const key = getChatKey(partnerId);
                    return messages[key] || [];
                };

                const getUnreadCount = (partnerId) => {
                    const chatMessages = getMessages(partnerId);
                    return chatMessages.filter(m => !m.read && m.sender !== currentUser.id).length;
                };

                const sendMessage = () => {
                    if (!messageText.trim() || !activeChat) return;

                    const key = getChatKey(activeChat.id);
                    const newMessage = {
                        id: Date.now(),
                        text: messageText,
                        sender: currentUser.id,
                        senderName: currentUser.name,
                        timestamp: new Date().toISOString(),
                        read: false
                    };

                    setMessages(prev => ({
                        ...prev,
                        [key]: [...(prev[key] || []), newMessage]
                    }));

                    setMessageText('');

                    // Simulate typing indicator
                    setShowTyping(true);
                    setTimeout(() => {
                        setShowTyping(false);
                        // Simulate auto-response for demo
                        if (Math.random() > 0.5) {
                            const autoResponse = {
                                id: Date.now() + 1,
                                text: getAutoResponse(),
                                sender: activeChat.id,
                                senderName: activeChat.name,
                                timestamp: new Date().toISOString(),
                                read: false
                            };
                            setMessages(prev => ({
                                ...prev,
                                [key]: [...prev[key], autoResponse]
                            }));
                        }
                    }, 2000);
                };

                const getAutoResponse = () => {
                    const responses = [
                        "That sounds great! Keep up the good work.",
                        "Let's discuss this in our next session.",
                        "I'll review this and get back to you shortly.",
                        "Thanks for the update! How are you feeling?",
                        "Excellent progress! Remember to stay hydrated.",
                        "Got it! Any questions about the plan?"
                    ];
                    return responses[Math.floor(Math.random() * responses.length)];
                };

                const markAsRead = (partnerId) => {
                    const key = getChatKey(partnerId);
                    setMessages(prev => ({
                        ...prev,
                        [key]: prev[key]?.map(m => ({ ...m, read: true })) || []
                    }));
                };

                const scheduleZoomMeeting = () => {
                    const zoomLink = `https://zoom.us/j/${Math.random().toString().substr(2, 9)}`;
                    const meetingMessage = {
                        id: Date.now(),
                        text: `I've scheduled a Zoom meeting for us!\n\n📅 Date: ${new Date(Date.now() + 86400000).toLocaleDateString()}\n⏰ Time: 2:00 PM EST\n🔗 Join: ${zoomLink}\n\nLooking forward to our session!`,
                        sender: currentUser.id,
                        senderName: currentUser.name,
                        timestamp: new Date().toISOString(),
                        read: false,
                        isZoomMeeting: true
                    };

                    const key = getChatKey(activeChat.id);
                    setMessages(prev => ({
                        ...prev,
                        [key]: [...(prev[key] || []), meetingMessage]
                    }));
                };

                useEffect(() => {
                    if (activeChat) {
                        markAsRead(activeChat.id);
                    }
                }, [activeChat]);

                useEffect(() => {
                    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
                }, [messages, activeChat]);

                return (
                    <div className="space-y-6">
                        <div className="clockwork-card p-4 sm:p-6">
                            <h2 className="text-xl sm:text-2xl font-bold text-white">Messages</h2>
                            <p className="text-gray-400 text-sm sm:text-base">Connect with your team</p>
                        </div>

                        <div className="chat-container">
                            <div className={`chat-sidebar ${showMobileChat ? 'hidden-mobile' : ''}`}>
                                <div className="chat-header">
                                    <input
                                        type="text"
                                        placeholder="Search conversations..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="chat-search"
                                    />
                                </div>
                                
                                <div className="chat-list">
                                    {chatPartners.map(partner => {
                                        const lastMessage = getMessages(partner.id).slice(-1)[0];
                                        const unreadCount = getUnreadCount(partner.id);
                                        
                                        return (
                                            <div
                                                key={partner.id}
                                                className={`chat-item ${activeChat?.id === partner.id ? 'active' : ''}`}
                                                onClick={() => {
                                                    setActiveChat(partner);
                                                    setShowMobileChat(true);
                                                }}
                                            >
                                                <div className="chat-avatar">
                                                    {partner.name.split(' ').map(n => n[0]).join('')}
                                                    {partner.online && <div className="online-indicator"></div>}
                                                </div>
                                                <div className="chat-item-info">
                                                    <div className="chat-item-name">
                                                        {partner.name}
                                                        {partner.roles.map(role => (
                                                            <span key={role} className={`clockwork-badge badge-${role} text-xxs`}>
                                                                {role}
                                                            </span>
                                                        ))}
                                                    </div>
                                                    {lastMessage && (
                                                        <div className="chat-item-message">
                                                            {lastMessage.sender === currentUser.id ? 'You: ' : ''}
                                                            {lastMessage.text.substring(0, 30)}...
                                                        </div>
                                                    )}
                                                </div>
                                                {lastMessage && (
                                                    <div className="chat-item-time">
                                                        {new Date(lastMessage.timestamp).toLocaleTimeString([], { 
                                                            hour: '2-digit', 
                                                            minute: '2-digit' 
                                                        })}
                                                    </div>
                                                )}
                                                {unreadCount > 0 && (
                                                    <div className="unread-count">{unreadCount}</div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                            
                            {activeChat ? (
                                <div className="chat-main">
                                    <div className="chat-main-header">
                                        {window.innerWidth <= 767 && (
                                            <button 
                                                className="back-to-chats"
                                                onClick={() => setShowMobileChat(false)}
                                            >
                                                <i className="fas fa-arrow-left"></i>
                                                Back
                                            </button>
                                        )}
                                        <div className="flex items-center gap-3">
                                            <div className="chat-avatar">
                                                {activeChat.name.split(' ').map(n => n[0]).join('')}
                                                {activeChat.online && <div className="online-indicator"></div>}
                                            </div>
                                            <div>
                                                <div className="font-semibold text-white">{activeChat.name}</div>
                                                <div className="text-xs text-gray-400">
                                                    {activeChat.online ? 'Active now' : 'Offline'}
                                                </div>
                                            </div>
                                        </div>
                                        <button onClick={scheduleZoomMeeting} className="zoom-btn">
                                            <i className="fas fa-video"></i>
                                            <span className="hidden sm:inline">Schedule Zoom</span>
                                        </button>
                                    </div>
                                    
                                    <div className="chat-messages">
                                        {getMessages(activeChat.id).map(message => (
                                            <div key={message.id} className="message-group">
                                                <div className={`message-bubble ${message.sender === currentUser.id ? 'message-sent' : 'message-received'} ${message.isZoomMeeting ? 'zoom-meeting' : ''}`}>
                                                    {message.text}
                                                </div>
                                                <div className="message-time">
                                                    {new Date(message.timestamp).toLocaleTimeString([], { 
                                                        hour: '2-digit', 
                                                        minute: '2-digit' 
                                                    })}
                                                </div>
                                            </div>
                                        ))}
                                        
                                        {showTyping && (
                                            <div className="typing-indicator">
                                                <div className="typing-dot"></div>
                                                <div className="typing-dot"></div>
                                                <div className="typing-dot"></div>
                                            </div>
                                        )}
                                        
                                        <div ref={messagesEndRef} />
                                    </div>
                                    
                                    <div className="chat-input-container">
                                        <textarea
                                            value={messageText}
                                            onChange={(e) => setMessageText(e.target.value)}
                                            onKeyPress={(e) => {
                                                if (e.key === 'Enter' && !e.shiftKey) {
                                                    e.preventDefault();
                                                    sendMessage();
                                                }
                                            }}
                                            placeholder="Type a message..."
                                            className="chat-input"
                                            rows="1"
                                        />
                                        <button 
                                            onClick={sendMessage}
                                            disabled={!messageText.trim()}
                                            className="chat-send-btn"
                                        >
                                            <i className="fas fa-paper-plane"></i>
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <div className="flex-1 flex items-center justify-center">
                                    <div className="text-center">
                                        <div className="text-4xl mb-4">💬</div>
                                        <p className="text-gray-400">Select a conversation to start messaging</p>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Reports Component
            const Reports = () => {
                const [selectedReport, setSelectedReport] = useState(null);
                const clientToUse = hasRole('client') ? currentUser.id : selectedClient?.id;

                const generateProgressReport = () => {
                    const measurements = clientData.measurements.filter(m => m.clientId === clientToUse);
                    const workouts = clientData.workouts.filter(w => w.clientId === clientToUse);
                    const goals = clientData.goals.filter(g => g.clientId === clientToUse);
                    
                    return {
                        title: 'Progress Report',
                        date: new Date().toLocaleDateString(),
                        sections: [
                            {
                                title: 'Measurements Summary',
                                content: measurements.length > 0 ? 
                                    `Latest Weight: ${measurements[measurements.length - 1].weight} lbs\n` +
                                    `Weight Change: ${measurements.length > 1 ? (measurements[measurements.length - 1].weight - measurements[0].weight).toFixed(1) : 0} lbs\n` +
                                    `Total Measurements: ${measurements.length}` : 
                                    'No measurements recorded yet'
                            },
                            {
                                title: 'Workout Summary',
                                content: `Total Workouts: ${workouts.length}\n` +
                                    `Completed: ${workouts.filter(w => w.completed).length}\n` +
                                    `Completion Rate: ${workouts.length > 0 ? Math.round((workouts.filter(w => w.completed).length / workouts.length) * 100) : 0}%`
                            },
                            {
                                title: 'Goals Progress',
                                content: goals.map(g => 
                                    `${g.name}: ${Math.round((g.current / g.target) * 100)}% complete`
                                ).join('\n') || 'No goals set'
                            }
                        ]
                    };
                };

                const generateWorkoutHistory = () => {
                    const workouts = clientData.workouts
                        .filter(w => w.clientId === clientToUse && w.completed)
                        .sort((a, b) => new Date(b.completedDate) - new Date(a.completedDate));
                    
                    return {
                        title: 'Workout History',
                        date: new Date().toLocaleDateString(),
                        sections: workouts.map(w => ({
                            title: `${w.name} - ${new Date(w.completedDate).toLocaleDateString()}`,
                            content: w.exercises.map(e => 
                                `${e.name}: ${e.actualSets || e.sets} × ${e.actualReps || e.reps} @ ${e.actualWeight || e.weight}lbs`
                            ).join('\n') + 
                            (w.moodFeedback ? `\nMood: ${'⭐'.repeat(w.moodFeedback)}` : '') +
                            (w.notes ? `\nNotes: ${w.notes}` : '')
                        }))
                    };
                };

                const generateNutritionReport = () => {
                    const nutrition = clientData.nutrition;
                    
                    return {
                        title: 'Nutrition Report',
                        date: new Date().toLocaleDateString(),
                        sections: [
                            {
                                title: 'Daily Targets',
                                content: nutrition ? 
                                    `Protein: ${nutrition.protein.target}g\n` +
                                    `Carbs: ${nutrition.carbs.target}g\n` +
                                    `Fat: ${nutrition.fat.target}g\n` +
                                    `Calories: ${nutrition.calories.target}` : 
                                    'No nutrition plan set'
                            },
                            {
                                title: 'Current Intake',
                                content: nutrition ? 
                                    `Protein: ${nutrition.protein.current}g (${Math.round((nutrition.protein.current / nutrition.protein.target) * 100)}%)\n` +
                                    `Carbs: ${nutrition.carbs.current}g (${Math.round((nutrition.carbs.current / nutrition.carbs.target) * 100)}%)\n` +
                                    `Fat: ${nutrition.fat.current}g (${Math.round((nutrition.fat.current / nutrition.fat.target) * 100)}%)\n` +
                                    `Calories: ${nutrition.calories.current} (${Math.round((nutrition.calories.current / nutrition.calories.target) * 100)}%)` : 
                                    'No data available'
                            }
                        ]
                    };
                };

                const downloadReport = (report) => {
                    let content = `${report.title}\n${'='.repeat(report.title.length)}\n\n`;
                    content += `Generated: ${report.date}\n\n`;
                    
                    report.sections.forEach(section => {
                        content += `${section.title}\n${'-'.repeat(section.title.length)}\n`;
                        content += `${section.content}\n\n`;
                    });
                    
                    const blob = new Blob([content], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${report.title.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                };

                const reportTypes = [
                    { id: 'progress', title: 'Progress Report', icon: '📊', generate: generateProgressReport },
                    { id: 'workout', title: 'Workout History', icon: '💪', generate: generateWorkoutHistory },
                    { id: 'nutrition', title: 'Nutrition Report', icon: '🥗', generate: generateNutritionReport }
                ];

                return (
                    <div className="space-y-6">
                        <div className="clockwork-card p-4 sm:p-6">
                            <h2 className="text-xl sm:text-2xl font-bold text-white">Reports</h2>
                            <p className="text-gray-400 text-sm sm:text-base">Generate and download detailed reports</p>
                            
                            {hasAnyRole('specialist', 'admin', 'owner') && (
                                <div className="mt-4">
                                    <select 
                                        onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                        className="clockwork-select max-w-xs"
                                        value={selectedClient?.id || ''}
                                    >
                                        <option value="">Select a client...</option>
                                        {getMyClients().map(client => (
                                            <option key={client.id} value={client.id}>{client.name}</option>
                                        ))}
                                    </select>
                                </div>
                            )}
                        </div>

                        {(hasRole('client') || selectedClient) ? (
                            <>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {reportTypes.map(reportType => (
                                        <div 
                                            key={reportType.id}
                                            className="report-card"
                                            onClick={() => setSelectedReport(reportType.generate())}
                                        >
                                            <div className="report-icon">{reportType.icon}</div>
                                            <h3 className="font-semibold text-lg text-white">{reportType.title}</h3>
                                            <p className="text-sm text-gray-400 mt-2">Click to generate</p>
                                        </div>
                                    ))}
                                </div>

                                {selectedReport && (
                                    <div className="clockwork-card p-4 sm:p-6">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-lg font-semibold text-white">{selectedReport.title}</h3>
                                            <button 
                                                onClick={() => downloadReport(selectedReport)}
                                                className="clockwork-button"
                                            >
                                                <i className="fas fa-download mr-2"></i>
                                                Download
                                            </button>
                                        </div>
                                        
                                        <div className="space-y-4">
                                            {selectedReport.sections.map((section, index) => (
                                                <div key={index}>
                                                    <h4 className="font-medium text-white mb-2">{section.title}</h4>
                                                    <pre className="whitespace-pre-wrap text-sm text-gray-300 bg-slate-800 p-3 rounded">
                                                        {section.content}
                                                    </pre>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </>
                        ) : (
                            <div className="empty-state">
                                <div className="empty-state-icon">📈</div>
                                <div className="empty-state-title">Select a client to generate reports</div>
                            </div>
                        )}
                    </div>
                );
            };

            // Billing Component
            const Billing = () => {
                const [showInvoiceForm, setShowInvoiceForm] = useState(false);
                const [showPaymentForm, setShowPaymentForm] = useState(false);
                const [selectedInvoice, setSelectedInvoice] = useState(null);
                const [newInvoice, setNewInvoice] = useState({
                    clientId: '',
                    description: '',
                    items: [{ description: '', amount: '' }],
                    dueDate: ''
                });

                const clientToUse = hasRole('client') ? currentUser.id : selectedClient?.id;
                const canManageBilling = hasAnyRole('specialist', 'admin', 'owner') && 
                    (currentUser.billingEnabled || hasRole('owner'));

                const myInvoices = clientData.billing?.invoices?.filter(i => 
                    hasRole('client') ? i.clientId === currentUser.id : 
                    (selectedClient ? i.clientId === selectedClient.id : false)
                ) || [];

                const handleCreateInvoice = () => {
                    if (!newInvoice.clientId && !hasRole('client')) {
                        setError('Please select a client');
                        return;
                    }

                    const invoice = {
                        id: `INV-${Date.now().toString().slice(-6)}`,
                        clientId: hasRole('client') ? currentUser.id : newInvoice.clientId,
                        issuedBy: currentUser.id,
                        date: new Date().toISOString().split('T')[0],
                        dueDate: newInvoice.dueDate,
                        amount: newInvoice.items.reduce((sum, item) => sum + (parseFloat(item.amount) || 0), 0),
                        status: 'pending',
                        description: newInvoice.description,
                        items: newInvoice.items.filter(item => item.description && item.amount).map(item => ({
                            description: item.description,
                            amount: parseFloat(item.amount)
                        }))
                    };

                    setClientData(prev => ({
                        ...prev,
                        billing: {
                            ...prev.billing,
                            invoices: [...(prev.billing?.invoices || []), invoice]
                        }
                    }));

                    setNewInvoice({
                        clientId: '',
                        description: '',
                        items: [{ description: '', amount: '' }],
                        dueDate: ''
                    });
                    setShowInvoiceForm(false);
                    setSuccessMessage('Invoice created successfully!');
                };

                const handlePayInvoice = (invoice) => {
                    const payment = {
                        id: `PAY-${Date.now().toString().slice(-6)}`,
                        invoiceId: invoice.id,
                        clientId: invoice.clientId,
                        amount: invoice.amount,
                        date: new Date().toISOString().split('T')[0],
                        method: 'card',
                        last4: '4242',
                        status: 'completed'
                    };

                    setClientData(prev => ({
                        ...prev,
                        billing: {
                            ...prev.billing,
                            invoices: prev.billing.invoices.map(i => 
                                i.id === invoice.id ? { ...i, status: 'paid', paidDate: payment.date } : i
                            ),
                            payments: [...(prev.billing?.payments || []), payment]
                        }
                    }));

                    setShowPaymentForm(false);
                    setSelectedInvoice(null);
                    setSuccessMessage('Payment processed successfully!');
                };

                const getTotalOutstanding = () => {
                    return myInvoices
                        .filter(i => i.status === 'pending')
                        .reduce((sum, i) => sum + i.amount, 0);
                };

                const getTotalPaid = () => {
                    return myInvoices
                        .filter(i => i.status === 'paid')
                        .reduce((sum, i) => sum + i.amount, 0);
                };

                return (
                    <div className="space-y-6">
                        <div className="clockwork-card p-4 sm:p-6">
                            <div className="flex justify-between items-center">
                                <h2 className="text-xl sm:text-2xl font-bold text-white">Billing & Payments</h2>
                                {canManageBilling && (
                                    <button 
                                        onClick={() => setShowInvoiceForm(!showInvoiceForm)}
                                        className="clockwork-button"
                                    >
                                        <span className="mr-2">📄</span>
                                        Create Invoice
                                    </button>
                                )}
                            </div>
                            
                            {hasAnyRole('specialist', 'admin', 'owner') && (
                                <div className="mt-4">
                                    <select 
                                        onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                        className="clockwork-select max-w-xs"
                                        value={selectedClient?.id || ''}
                                    >
                                        <option value="">Select a client...</option>
                                        {getMyClients().map(client => (
                                            <option key={client.id} value={client.id}>{client.name}</option>
                                        ))}
                                    </select>
                                </div>
                            )}
                        </div>

                        {showInvoiceForm && canManageBilling && (
                            <div className="billing-card">
                                <h3 className="text-lg font-semibold mb-4 text-white">Create New Invoice</h3>
                                <form onSubmit={(e) => { e.preventDefault(); handleCreateInvoice(); }}>
                                    {!hasRole('client') && (
                                        <div className="form-group">
                                            <label className="form-label">Client</label>
                                            <select
                                                value={newInvoice.clientId}
                                                onChange={(e) => setNewInvoice(prev => ({ ...prev, clientId: e.target.value }))}
                                                className="clockwork-select"
                                                required
                                            >
                                                <option value="">Select a client...</option>
                                                {getMyClients().map(client => (
                                                    <option key={client.id} value={client.id}>{client.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                    )}
                                    
                                    <div className="form-group">
                                        <label className="form-label">Invoice Description</label>
                                        <input
                                            type="text"
                                            value={newInvoice.description}
                                            onChange={(e) => setNewInvoice(prev => ({ ...prev, description: e.target.value }))}
                                            className="clockwork-input"
                                            placeholder="Monthly Training Package"
                                            required
                                        />
                                    </div>
                                    
                                    <div className="form-group">
                                        <label className="form-label">Due Date</label>
                                        <input
                                            type="date"
                                            value={newInvoice.dueDate}
                                            onChange={(e) => setNewInvoice(prev => ({ ...prev, dueDate: e.target.value }))}
                                            className="clockwork-input"
                                            required
                                        />
                                    </div>
                                    
                                    <div className="space-y-2 mb-4">
                                        <label className="form-label">Invoice Items</label>
                                        {newInvoice.items.map((item, index) => (
                                            <div key={index} className="flex gap-2">
                                                <input
                                                    type="text"
                                                    placeholder="Item description"
                                                    value={item.description}
                                                    onChange={(e) => {
                                                        const newItems = [...newInvoice.items];
                                                        newItems[index].description = e.target.value;
                                                        setNewInvoice(prev => ({ ...prev, items: newItems }));
                                                    }}
                                                    className="clockwork-input flex-1"
                                                />
                                                <div className="price-input-group">
                                                    <span>$</span>
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        placeholder="0.00"
                                                        value={item.amount}
                                                        onChange={(e) => {
                                                            const newItems = [...newInvoice.items];
                                                            newItems[index].amount = e.target.value;
                                                            setNewInvoice(prev => ({ ...prev, items: newItems }));
                                                        }}
                                                        className="clockwork-input"
                                                        style={{ width: '150px' }}
                                                    />
                                                </div>
                                                {newInvoice.items.length > 1 && (
                                                    <button
                                                        type="button"
                                                        onClick={() => {
                                                            const newItems = newInvoice.items.filter((_, i) => i !== index);
                                                            setNewInvoice(prev => ({ ...prev, items: newItems }));
                                                        }}
                                                        className="text-red-400 hover:text-red-300"
                                                    >
                                                        ❌
                                                    </button>
                                                )}
                                            </div>
                                        ))}
                                        
                                        <button
                                            type="button"
                                            onClick={() => setNewInvoice(prev => ({
                                                ...prev,
                                                items: [...prev.items, { description: '', amount: '' }]
                                            }))}
                                            className="clockwork-button-secondary"
                                        >
                                            Add Item
                                        </button>
                                    </div>
                                    
                                    <div className="flex justify-between items-center mb-4">
                                        <span className="font-semibold text-white">Total:</span>
                                        <span className="text-xl font-bold text-green-400">
                                            ${newInvoice.items.reduce((sum, item) => sum + (parseFloat(item.amount) || 0), 0).toFixed(2)}
                                        </span>
                                    </div>
                                    
                                    <div className="flex gap-2">
                                        <button type="submit" className="clockwork-button">
                                            Create Invoice
                                        </button>
                                        <button 
                                            type="button"
                                            onClick={() => setShowInvoiceForm(false)}
                                            className="clockwork-button-secondary"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}

                        {(hasRole('client') || selectedClient) && (
                            <>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div className="stat-card">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-2xl">💰</span>
                                            <span className="text-2xl font-bold text-green-400">
                                                ${getTotalPaid().toFixed(2)}
                                            </span>
                                        </div>
                                        <p className="text-sm text-gray-400">Total Paid</p>
                                    </div>
                                    
                                    <div className="stat-card">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-2xl">📊</span>
                                            <span className="text-2xl font-bold text-amber-400">
                                                ${getTotalOutstanding().toFixed(2)}
                                            </span>
                                        </div>
                                        <p className="text-sm text-gray-400">Outstanding</p>
                                    </div>
                                    
                                    <div className="stat-card">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-2xl">📄</span>
                                            <span className="text-2xl font-bold text-blue-400">
                                                {myInvoices.length}
                                            </span>
                                        </div>
                                        <p className="text-sm text-gray-400">Total Invoices</p>
                                    </div>
                                </div>

                                <div className="clockwork-card p-4 sm:p-6">
                                    <h3 className="text-lg font-semibold mb-4 text-white">Invoice History</h3>
                                    <div className="responsive-table">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th className="text-left px-4 py-2">Invoice #</th>
                                                    <th className="text-left px-4 py-2">Date</th>
                                                    <th className="text-left px-4 py-2">Description</th>
                                                    <th className="text-left px-4 py-2">Amount</th>
                                                    <th className="text-left px-4 py-2">Status</th>
                                                    <th className="text-left px-4 py-2">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {myInvoices.length === 0 ? (
                                                    <tr>
                                                        <td colSpan="6" className="text-center py-8">
                                                            <div className="empty-state">
                                                                <div className="empty-state-icon">💳</div>
                                                                <div className="empty-state-title">No invoices yet</div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ) : (
                                                    myInvoices.map(invoice => (
                                                        <tr key={invoice.id}>
                                                            <td className="px-4 py-2">{invoice.id}</td>
                                                            <td className="px-4 py-2">{invoice.date}</td>
                                                            <td className="px-4 py-2">{invoice.description}</td>
                                                            <td className="px-4 py-2">${invoice.amount.toFixed(2)}</td>
                                                            <td className="px-4 py-2">
                                                                <span className={`invoice-status ${invoice.status}`}>
                                                                    {invoice.status}
                                                                </span>
                                                            </td>
                                                            <td className="px-4 py-2">
                                                                {invoice.status === 'pending' && hasRole('client') && (
                                                                    <button
                                                                        onClick={() => {
                                                                            setSelectedInvoice(invoice);
                                                                            setShowPaymentForm(true);
                                                                        }}
                                                                        className="clockwork-button-success text-sm"
                                                                    >
                                                                        Pay Now
                                                                    </button>
                                                                )}
                                                            </td>
                                                        </tr>
                                                    ))
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                {/* Payment Modal */}
                                {showPaymentForm && selectedInvoice && (
                                    <div className="modal-overlay" onClick={() => setShowPaymentForm(false)}>
                                        <div className="modal-content max-w-lg" onClick={(e) => e.stopPropagation()}>
                                            <h3 className="text-xl font-semibold mb-4 text-white">Process Payment</h3>
                                            
                                            <div className="billing-card mb-4">
                                                <h4 className="font-medium mb-2 text-white">Invoice Details</h4>
                                                <p className="text-sm text-gray-300">Invoice: {selectedInvoice.id}</p>
                                                <p className="text-sm text-gray-300">Amount: ${selectedInvoice.amount.toFixed(2)}</p>
                                                <p className="text-sm text-gray-300">Due: {selectedInvoice.dueDate}</p>
                                            </div>
                                            
                                            <form onSubmit={(e) => { e.preventDefault(); handlePayInvoice(selectedInvoice); }}>
                                                <div className="form-group">
                                                    <label className="form-label">Card Number</label>
                                                    <input
                                                        type="text"
                                                        placeholder="4242 4242 4242 4242"
                                                        className="clockwork-input"
                                                        required
                                                    />
                                                </div>
                                                
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div className="form-group">
                                                        <label className="form-label">Expiry</label>
                                                        <input
                                                            type="text"
                                                            placeholder="MM/YY"
                                                            className="clockwork-input"
                                                            required
                                                        />
                                                    </div>
                                                    
                                                    <div className="form-group">
                                                        <label className="form-label">CVV</label>
                                                        <input
                                                            type="text"
                                                            placeholder="123"
                                                            className="clockwork-input"
                                                            required
                                                        />
                                                    </div>
                                                </div>
                                                
                                                <div className="flex gap-2 mt-6">
                                                    <button type="submit" className="clockwork-button-success">
                                                        Pay ${selectedInvoice.amount.toFixed(2)}
                                                    </button>
                                                    <button 
                                                        type="button"
                                                        onClick={() => setShowPaymentForm(false)}
                                                        className="clockwork-button-secondary"
                                                    >
                                                        Cancel
                                                    </button>
                                                </div>
                                            </form>
                                            
                                            <p className="text-xs text-gray-400 mt-4">
                                                This is a demo. No real payment will be processed.
                                            </p>
                                        </div>
                                    </div>
                                )}
                            </>
                        )}
                    </div>
                );
            };

            // Training Component (Owner Only)
            const Training = () => {
                const [showScheduleForm, setShowScheduleForm] = useState(false);
                const [selectedSession, setSelectedSession] = useState(null);
                const [newSession, setNewSession] = useState({
                    clientId: '',
                    date: '',
                    time: '',
                    duration: '60',
                    type: 'Personal Training',
                    notes: ''
                });

                const mySessions = clientData.trainingSessions?.filter(s => 
                    hasRole('owner') ? s.trainerId === currentUser.id : s.clientId === currentUser.id
                ) || [];

                const upcomingSessions = mySessions.filter(s => 
                    new Date(`${s.date} ${s.time}`) > new Date() && s.status !== 'completed'
                );

                const completedSessions = mySessions.filter(s => s.status === 'completed');

                const handleScheduleSession = () => {
                    if (!newSession.clientId) {
                        setError('Please select a client');
                        return;
                    }

                    const session = {
                        id: `SESSION-${Date.now().toString().slice(-6)}`,
                        trainerId: currentUser.id,
                        clientId: newSession.clientId,
                        date: newSession.date,
                        time: newSession.time,
                        duration: parseInt(newSession.duration),
                        type: newSession.type,
                        status: 'scheduled',
                        notes: newSession.notes,
                        createdAt: new Date().toISOString()
                    };

                    setClientData(prev => ({
                        ...prev,
                        trainingSessions: [...(prev.trainingSessions || []), session]
                    }));

                    setNewSession({
                        clientId: '',
                        date: '',
                        time: '',
                        duration: '60',
                        type: 'Personal Training',
                        notes: ''
                    });
                    setShowScheduleForm(false);
                    setSuccessMessage('Training session scheduled successfully!');
                };

                const markSessionComplete = (sessionId) => {
                    setClientData(prev => ({
                        ...prev,
                        trainingSessions: prev.trainingSessions.map(s => 
                            s.id === sessionId ? { ...s, status: 'completed', completedAt: new Date().toISOString() } : s
                        )
                    }));
                    setSuccessMessage('Session marked as complete!');
                };

                const cancelSession = (sessionId) => {
                    if (confirm('Are you sure you want to cancel this session?')) {
                        setClientData(prev => ({
                            ...prev,
                            trainingSessions: prev.trainingSessions.filter(s => s.id !== sessionId)
                        }));
                        setSuccessMessage('Session cancelled');
                    }
                };

                return (
                    <div className="space-y-6">
                        <div className="clockwork-card p-4 sm:p-6">
                            <div className="flex justify-between items-center">
                                <h2 className="text-xl sm:text-2xl font-bold text-white">Training Sessions</h2>
                                <button 
                                    onClick={() => setShowScheduleForm(!showScheduleForm)}
                                    className="clockwork-button"
                                >
                                    <span className="mr-2">📅</span>
                                    Schedule Session
                                </button>
                            </div>
                            <p className="text-gray-400 text-sm sm:text-base">Manage your training appointments</p>
                        </div>

                        {showScheduleForm && (
                            <div className="clockwork-card p-4 sm:p-6">
                                <h3 className="text-lg font-semibold mb-4 text-white">Schedule New Session</h3>
                                <form onSubmit={(e) => { e.preventDefault(); handleScheduleSession(); }}>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="form-group">
                                            <label className="form-label">Client</label>
                                            <select
                                                value={newSession.clientId}
                                                onChange={(e) => setNewSession(prev => ({ ...prev, clientId: e.target.value }))}
                                                className="clockwork-select"
                                                required
                                            >
                                                <option value="">Select a client...</option>
                                                {getMyClients().map(client => (
                                                    <option key={client.id} value={client.id}>{client.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Session Type</label>
                                            <select
                                                value={newSession.type}
                                                onChange={(e) => setNewSession(prev => ({ ...prev, type: e.target.value }))}
                                                className="clockwork-select"
                                            >
                                                <option value="Personal Training">Personal Training</option>
                                                <option value="Group Training">Group Training</option>
                                                <option value="Assessment">Assessment</option>
                                                <option value="Consultation">Consultation</option>
                                            </select>
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Date</label>
                                            <input
                                                type="date"
                                                value={newSession.date}
                                                onChange={(e) => setNewSession(prev => ({ ...prev, date: e.target.value }))}
                                                className="clockwork-input"
                                                required
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Time</label>
                                            <input
                                                type="time"
                                                value={newSession.time}
                                                onChange={(e) => setNewSession(prev => ({ ...prev, time: e.target.value }))}
                                                className="clockwork-input"
                                                required
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Duration (minutes)</label>
                                            <select
                                                value={newSession.duration}
                                                onChange={(e) => setNewSession(prev => ({ ...prev, duration: e.target.value }))}
                                                className="clockwork-select"
                                            >
                                                <option value="30">30 minutes</option>
                                                <option value="45">45 minutes</option>
                                                <option value="60">60 minutes</option>
                                                <option value="90">90 minutes</option>
                                            </select>
                                        </div>
                                        
                                        <div className="form-group md:col-span-2">
                                            <label className="form-label">Notes</label>
                                            <textarea
                                                value={newSession.notes}
                                                onChange={(e) => setNewSession(prev => ({ ...prev, notes: e.target.value }))}
                                                className="clockwork-input"
                                                rows="3"
                                                placeholder="Session goals, focus areas, etc."
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="flex gap-2 mt-4">
                                        <button type="submit" className="clockwork-button">
                                            Schedule Session
                                        </button>
                                        <button 
                                            type="button"
                                            onClick={() => setShowScheduleForm(false)}
                                            className="clockwork-button-secondary"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="clockwork-card p-4 sm:p-6">
                                <h3 className="text-lg font-semibold mb-4 text-white">Upcoming Sessions</h3>
                                {upcomingSessions.length === 0 ? (
                                    <p className="text-gray-400">No upcoming sessions scheduled</p>
                                ) : (
                                    <div className="space-y-3">
                                        {upcomingSessions.map(session => {
                                            const client = allUsers.find(u => u.id === session.clientId);
                                            return (
                                                <div key={session.id} className="training-slot">
                                                    <div className="flex justify-between items-start">
                                                        <div>
                                                            <p className="font-medium text-white">{client?.name}</p>
                                                            <p className="text-sm text-gray-400">
                                                                {session.type} - {session.duration} min
                                                            </p>
                                                            <p className="text-xs text-gray-500">
                                                                {new Date(session.date).toLocaleDateString()} at {session.time}
                                                            </p>
                                                            {session.notes && (
                                                                <p className="text-xs text-gray-400 mt-1">
                                                                    📝 {session.notes}
                                                                </p>
                                                            )}
                                                        </div>
                                                        <div className="flex flex-col gap-2">
                                                            <button
                                                                onClick={() => markSessionComplete(session.id)}
                                                                className="clockwork-button-success text-xs"
                                                            >
                                                                Complete
                                                            </button>
                                                            <button
                                                                onClick={() => cancelSession(session.id)}
                                                                className="text-red-400 hover:text-red-300 text-xs"
                                                            >
                                                                Cancel
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>

                            <div className="clockwork-card p-4 sm:p-6">
                                <h3 className="text-lg font-semibold mb-4 text-white">Completed Sessions</h3>
                                {completedSessions.length === 0 ? (
                                    <p className="text-gray-400">No completed sessions yet</p>
                                ) : (
                                    <div className="space-y-3">
                                        {completedSessions.slice(0, 5).map(session => {
                                            const client = allUsers.find(u => u.id === session.clientId);
                                            return (
                                                <div key={session.id} className="training-slot booked">
                                                    <p className="font-medium text-white">{client?.name}</p>
                                                    <p className="text-sm text-gray-400">
                                                        {session.type} - {session.duration} min
                                                    </p>
                                                    <p className="text-xs text-gray-500">
                                                        Completed: {new Date(session.date).toLocaleDateString()}
                                                    </p>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // Users Component (Admin/Owner Only)
            const Users = () => {
                const [showAddUserForm, setShowAddUserForm] = useState(false);
                const [editingUser, setEditingUser] = useState(null);
                const [newUser, setNewUser] = useState({
                    name: '',
                    email: '',
                    password: '',
                    phone: '',
                    roles: ['client'],
                    billingEnabled: false,
                    canTrainClients: false
                });

                const handleAddUser = () => {
                    const user = {
                        id: `user_${Date.now()}`,
                        ...newUser,
                        clientIds: [],
                        specialistIds: [],
                        online: false
                    };

                    setAllUsers(prev => [...prev, user]);
                    setNewUser({
                        name: '',
                        email: '',
                        password: '',
                        phone: '',
                        roles: ['client'],
                        billingEnabled: false,
                        canTrainClients: false
                    });
                    setShowAddUserForm(false);
                    setSuccessMessage('User created successfully!');
                };

                const handleUpdateUser = () => {
                    setAllUsers(prev => prev.map(u => 
                        u.id === editingUser.id ? editingUser : u
                    ));
                    setEditingUser(null);
                    setSuccessMessage('User updated successfully!');
                };

                const handleDeleteUser = (userId) => {
                    if (confirm('Are you sure you want to delete this user?')) {
                        setAllUsers(prev => prev.filter(u => u.id !== userId));
                        setSuccessMessage('User deleted successfully');
                    }
                };

                const toggleRole = (role) => {
                    if (editingUser) {
                        const newRoles = editingUser.roles.includes(role)
                            ? editingUser.roles.filter(r => r !== role)
                            : [...editingUser.roles, role];
                        setEditingUser(prev => ({ ...prev, roles: newRoles }));
                    } else {
                        const newRoles = newUser.roles.includes(role)
                            ? newUser.roles.filter(r => r !== role)
                            : [...newUser.roles, role];
                        setNewUser(prev => ({ ...prev, roles: newRoles }));
                    }
                };

                return (
                    <div className="space-y-6">
                        <div className="clockwork-card p-4 sm:p-6">
                            <div className="flex justify-between items-center">
                                <h2 className="text-xl sm:text-2xl font-bold text-white">User Management</h2>
                                <button 
                                    onClick={() => setShowAddUserForm(!showAddUserForm)}
                                    className="clockwork-button"
                                >
                                    <span className="mr-2">➕</span>
                                    Add User
                                </button>
                            </div>
                            <p className="text-gray-400 text-sm sm:text-base">Manage platform users and permissions</p>
                        </div>

                        {showAddUserForm && (
                            <div className="clockwork-card p-4 sm:p-6">
                                <h3 className="text-lg font-semibold mb-4 text-white">Create New User</h3>
                                <form onSubmit={(e) => { e.preventDefault(); handleAddUser(); }}>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="form-group">
                                            <label className="form-label">Full Name</label>
                                            <input
                                                type="text"
                                                value={newUser.name}
                                                onChange={(e) => setNewUser(prev => ({ ...prev, name: e.target.value }))}
                                                className="clockwork-input"
                                                required
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Email</label>
                                            <input
                                                type="email"
                                                value={newUser.email}
                                                onChange={(e) => setNewUser(prev => ({ ...prev, email: e.target.value }))}
                                                className="clockwork-input"
                                                required
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Password</label>
                                            <input
                                                type="password"
                                                value={newUser.password}
                                                onChange={(e) => setNewUser(prev => ({ ...prev, password: e.target.value }))}
                                                className="clockwork-input"
                                                required
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Phone</label>
                                            <input
                                                type="tel"
                                                value={newUser.phone}
                                                onChange={(e) => setNewUser(prev => ({ ...prev, phone: e.target.value }))}
                                                className="clockwork-input"
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="form-group">
                                        <label className="form-label">User Roles</label>
                                        <div className="permission-matrix">
                                            {['client', 'specialist', 'admin', 'owner', 'engineer'].map(role => (
                                                <div key={role} className="permission-item">
                                                    <input
                                                        type="checkbox"
                                                        checked={newUser.roles.includes(role)}
                                                        onChange={() => toggleRole(role)}
                                                    />
                                                    <label className="capitalize">{role}</label>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    {(newUser.roles.includes('specialist') || newUser.roles.includes('admin') || newUser.roles.includes('owner')) && (
                                        <div className="form-group">
                                            <label className="form-label">Additional Permissions</label>
                                            <div className="space-y-2">
                                                <label className="flex items-center gap-2">
                                                    <input
                                                        type="checkbox"
                                                        checked={newUser.billingEnabled}
                                                        onChange={(e) => setNewUser(prev => ({ ...prev, billingEnabled: e.target.checked }))}
                                                    />
                                                    <span>Enable Billing Functions</span>
                                                </label>
                                                {newUser.roles.includes('owner') && (
                                                    <label className="flex items-center gap-2">
                                                        <input
                                                            type="checkbox"
                                                            checked={newUser.canTrainClients}
                                                            onChange={(e) => setNewUser(prev => ({ ...prev, canTrainClients: e.target.checked }))}
                                                        />
                                                        <span>Can Train Clients</span>
                                                    </label>
                                                )}
                                            </div>
                                        </div>
                                    )}
                                    
                                    <div className="flex gap-2 mt-4">
                                        <button type="submit" className="clockwork-button">
                                            Create User
                                        </button>
                                        <button 
                                            type="button"
                                            onClick={() => setShowAddUserForm(false)}
                                            className="clockwork-button-secondary"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}

                        <div className="clockwork-card p-4 sm:p-6">
                            <h3 className="text-lg font-semibold mb-4 text-white">All Users</h3>
                            <div className="users-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th className="text-left px-4 py-2">Name</th>
                                            <th className="text-left px-4 py-2">Email</th>
                                            <th className="text-left px-4 py-2 hide-mobile">Phone</th>
                                            <th className="text-left px-4 py-2">Roles</th>
                                            <th className="text-left px-4 py-2">Status</th>
                                            <th className="text-left px-4 py-2">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {allUsers.map(user => (
                                            <tr key={user.id}>
                                                <td className="px-4 py-2">{user.name}</td>
                                                <td className="px-4 py-2">{user.email}</td>
                                                <td className="px-4 py-2 hide-mobile">{user.phone || '-'}</td>
                                                <td className="px-4 py-2">
                                                    {user.roles.map(role => (
                                                        <span key={role} className={`clockwork-badge badge-${role} mr-1`}>
                                                            {role}
                                                        </span>
                                                    ))}
                                                </td>
                                                <td className="px-4 py-2">
                                                    {user.online ? (
                                                        <span className="text-green-400">Online</span>
                                                    ) : (
                                                        <span className="text-gray-400">Offline</span>
                                                    )}
                                                </td>
                                                <td className="px-4 py-2">
                                                    <button
                                                        onClick={() => setEditingUser(user)}
                                                        className="text-blue-400 hover:text-blue-300 mr-2"
                                                    >
                                                        ✏️
                                                    </button>
                                                    <button
                                                        onClick={() => handleDeleteUser(user.id)}
                                                        className="text-red-400 hover:text-red-300"
                                                    >
                                                        🗑️
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Edit User Modal */}
                        {editingUser && (
                            <div className="modal-overlay" onClick={() => setEditingUser(null)}>
                                <div className="modal-content max-w-2xl" onClick={(e) => e.stopPropagation()}>
                                    <h3 className="text-xl font-semibold mb-4 text-white">Edit User: {editingUser.name}</h3>
                                    
                                    <form onSubmit={(e) => { e.preventDefault(); handleUpdateUser(); }}>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div className="form-group">
                                                <label className="form-label">Full Name</label>
                                                <input
                                                    type="text"
                                                    value={editingUser.name}
                                                    onChange={(e) => setEditingUser(prev => ({ ...prev, name: e.target.value }))}
                                                    className="clockwork-input"
                                                    required
                                                />
                                            </div>
                                            
                                            <div className="form-group">
                                                <label className="form-label">Email</label>
                                                <input
                                                    type="email"
                                                    value={editingUser.email}
                                                    onChange={(e) => setEditingUser(prev => ({ ...prev, email: e.target.value }))}
                                                    className="clockwork-input"
                                                    required
                                                />
                                            </div>
                                            
                                            <div className="form-group">
                                                <label className="form-label">Phone</label>
                                                <input
                                                    type="tel"
                                                    value={editingUser.phone || ''}
                                                    onChange={(e) => setEditingUser(prev => ({ ...prev, phone: e.target.value }))}
                                                    className="clockwork-input"
                                                />
                                            </div>
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">User Roles</label>
                                            <div className="permission-matrix">
                                                {['client', 'specialist', 'admin', 'owner', 'engineer'].map(role => (
                                                    <div key={role} className="permission-item">
                                                        <input
                                                            type="checkbox"
                                                            checked={editingUser.roles.includes(role)}
                                                            onChange={() => toggleRole(role)}
                                                        />
                                                        <label className="capitalize">{role}</label>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        
                                        {(editingUser.roles.includes('specialist') || editingUser.roles.includes('admin') || editingUser.roles.includes('owner')) && (
                                            <div className="form-group">
                                                <label className="form-label">Additional Permissions</label>
                                                <div className="space-y-2">
                                                    <label className="flex items-center gap-2">
                                                        <input
                                                            type="checkbox"
                                                            checked={editingUser.billingEnabled || false}
                                                            onChange={(e) => setEditingUser(prev => ({ ...prev, billingEnabled: e.target.checked }))}
                                                        />
                                                        <span>Enable Billing Functions</span>
                                                    </label>
                                                    {editingUser.roles.includes('owner') && (
                                                        <label className="flex items-center gap-2">
                                                            <input
                                                                type="checkbox"
                                                                checked={editingUser.canTrainClients || false}
                                                                onChange={(e) => setEditingUser(prev => ({ ...prev, canTrainClients: e.target.checked }))}
                                                            />
                                                            <span>Can Train Clients</span>
                                                        </label>
                                                    )}
                                                </div>
                                            </div>
                                        )}
                                        
                                        <div className="flex gap-2 mt-6">
                                            <button type="submit" className="clockwork-button">
                                                Update User
                                            </button>
                                            <button 
                                                type="button"
                                                onClick={() => setEditingUser(null)}
                                                className="clockwork-button-secondary"
                                            >
                                                Cancel
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Tests Component
            const Tests = () => {
                const [showAddForm, setShowAddForm] = useState(false);
                const [newTest, setNewTest] = useState({
                    name: '',
                    date: new Date().toISOString().split('T')[0],
                    results: ''
                });

                const clientToUse = hasRole('client') ? currentUser.id : selectedClient?.id;
                const myTests = clientData.tests.filter(t => t.clientId === clientToUse);

                const handleAddTest = (e) => {
                    e.preventDefault();
                    if (!clientToUse) {
                        setError('Please select a client first');
                        return;
                    }

                    const test = {
                        id: Date.now(),
                        clientId: clientToUse,
                        performedBy: currentUser.id,
                        name: newTest.name,
                        date: newTest.date,
                        results: newTest.results,
                        createdAt: new Date().toISOString()
                    };

                    setClientData(prev => ({
                        ...prev,
                        tests: [...prev.tests, test]
                    }));

                    setNewTest({ name: '', date: new Date().toISOString().split('T')[0], results: '' });
                    setShowAddForm(false);
                    setSuccessMessage('Test recorded successfully!');
                };

                return (
                    <div className="space-y-6">
                        <div className="clockwork-card p-4 sm:p-6">
                            <div className="flex justify-between items-center">
                                <h2 className="text-xl sm:text-2xl font-bold text-white">Tests & Assessments</h2>
                                {hasAnyRole('specialist', 'admin', 'owner') && (
                                    <button 
                                        onClick={() => setShowAddForm(!showAddForm)}
                                        className="clockwork-button"
                                    >
                                        <span className="mr-2">➕</span>
                                        Add Test
                                    </button>
                                )}
                            </div>
                            
                            {hasAnyRole('specialist', 'admin', 'owner') && (
                                <div className="mt-4">
                                    <select 
                                        onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                        className="clockwork-select max-w-xs"
                                        value={selectedClient?.id || ''}
                                    >
                                        <option value="">Select a client...</option>
                                        {getMyClients().map(client => (
                                            <option key={client.id} value={client.id}>{client.name}</option>
                                        ))}
                                    </select>
                                </div>
                            )}
                        </div>

                        {showAddForm && (
                            <div className="clockwork-card p-4 sm:p-6">
                                <h3 className="text-lg font-semibold mb-4 text-white">Record New Test</h3>
                                <form onSubmit={handleAddTest}>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="form-group">
                                            <label className="form-label">Test Name</label>
                                            <input
                                                type="text"
                                                value={newTest.name}
                                                onChange={(e) => setNewTest(prev => ({ ...prev, name: e.target.value }))}
                                                className="clockwork-input"
                                                placeholder="Body Composition Analysis"
                                                required
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Date</label>
                                            <input
                                                type="date"
                                                value={newTest.date}
                                                onChange={(e) => setNewTest(prev => ({ ...prev, date: e.target.value }))}
                                                className="clockwork-input"
                                                required
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="form-group">
                                        <label className="form-label">Results</label>
                                        <textarea
                                            value={newTest.results}
                                            onChange={(e) => setNewTest(prev => ({ ...prev, results: e.target.value }))}
                                            className="clockwork-input"
                                            rows="4"
                                            placeholder="Enter test results..."
                                            required
                                        />
                                    </div>
                                    
                                    <div className="flex gap-2">
                                        <button type="submit" className="clockwork-button">
                                            Save Test Results
                                        </button>
                                        <button 
                                            type="button" 
                                            onClick={() => setShowAddForm(false)}
                                            className="clockwork-button-secondary"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}

                        {(hasRole('client') || selectedClient) ? (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {myTests.length === 0 ? (
                                    <div className="col-span-full">
                                        <div className="empty-state">
                                            <div className="empty-state-icon">🧪</div>
                                            <div className="empty-state-title">No tests recorded yet</div>
                                            <div className="empty-state-description">
                                                Tests and assessments will appear here
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    myTests.map(test => {
                                        const performer = allUsers.find(u => u.id === test.performedBy);
                                        return (
                                            <div key={test.id} className="clockwork-card p-4 sm:p-6">
                                                <div className="flex justify-between items-start mb-3">
                                                    <h3 className="font-semibold text-lg text-white">{test.name}</h3>
                                                    <span className="text-sm text-gray-400">{test.date}</span>
                                                </div>
                                                
                                                <div className="space-y-2">
                                                    <p className="text-sm text-gray-300">{test.results}</p>
                                                    <p className="text-xs text-gray-400">
                                                        Performed by: {performer?.name || 'Unknown'}
                                                    </p>
                                                </div>
                                                
                                                {hasAnyRole('specialist', 'admin', 'owner') && (
                                                    <button 
                                                        onClick={() => {
                                                            if (confirm('Are you sure you want to delete this test?')) {
                                                                setClientData(prev => ({
                                                                    ...prev,
                                                                    tests: prev.tests.filter(t => t.id !== test.id)
                                                                }));
                                                                setSuccessMessage('Test deleted successfully');
                                                            }
                                                        }}
                                                        className="text-red-400 hover:text-red-300 mt-3"
                                                    >
                                                        🗑️ Delete
                                                    </button>
                                                )}
                                            </div>
                                        );
                                    })
                                )}
                            </div>
                        ) : (
                            <div className="empty-state">
                                <div className="empty-state-icon">🧪</div>
                                <div className="empty-state-title">Select a client to view tests</div>
                            </div>
                        )}
                    </div>
                );
            };

            // Engineer Console Component
            const EngineerConsole = () => {
                const [systemStatus, setSystemStatus] = useState({
                    server: 'Online',
                    database: 'localStorage',
                    cache: 'Active',
                    users: allUsers.length,
                    activeUsers: allUsers.filter(u => u.online).length,
                    storageUsed: '0',
                    lastBackup: new Date().toISOString()
                });

                useEffect(() => {
                    // Calculate storage used
                    let total = 0;
                    for (let key in localStorage) {
                        if (key.startsWith('clockwork')) {
                            total += localStorage[key].length;
                        }
                    }
                    setSystemStatus(prev => ({
                        ...prev,
                        storageUsed: (total / 1024).toFixed(2) + ' KB'
                    }));
                }, []);

                const clearCache = () => {
                    if (confirm('Are you sure you want to clear the cache?')) {
                        // Clear only clockwork-related items
                        const keysToRemove = [];
                        for (let key in localStorage) {
                            if (key.startsWith('clockwork') && key !== 'clockworkLogo') {
                                keysToRemove.push(key);
                            }
                        }
                        keysToRemove.forEach(key => localStorage.removeItem(key));
                        setSuccessMessage('Cache cleared successfully');
                        window.location.reload();
                    }
                };

                const exportDatabase = () => {
                    const data = {
                        clientData,
                        messages,
                        allUsers,
                        exportDate: new Date().toISOString(),
                        version: '1.0'
                    };
                    
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `clockwork-database-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                };

                return (
                    <div className="space-y-6">
                        <div className="clockwork-card p-4 sm:p-6">
                            <h2 className="text-xl sm:text-2xl font-bold text-white">Engineer Console</h2>
                            <p className="text-gray-400 text-sm sm:text-base">System monitoring and maintenance</p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div className="metric-card">
                                <div className="metric-value">{systemStatus.users}</div>
                                <div className="metric-label">Total Users</div>
                            </div>
                            
                            <div className="metric-card">
                                <div className="metric-value">{systemStatus.activeUsers}</div>
                                <div className="metric-label">Active Users</div>
                            </div>
                            
                            <div className="metric-card">
                                <div className="metric-value">{systemStatus.storageUsed}</div>
                                <div className="metric-label">Storage Used</div>
                            </div>
                            
                            <div className="metric-card">
                                <div className="metric-value text-green-400">✓</div>
                                <div className="metric-label">System Status</div>
                            </div>
                        </div>

                        <div className="clockwork-card p-4 sm:p-6">
                            <h3 className="text-lg font-semibold mb-4 text-white">System Information</h3>
                            <div className="engineer-console">
                                <pre>{`CLOCKWORK SYSTEM STATUS
========================
Server Status: ${systemStatus.server}
Database Type: ${systemStatus.database}
Cache Status: ${systemStatus.cache}
Total Users: ${systemStatus.users}
Active Users: ${systemStatus.activeUsers}
Storage Used: ${systemStatus.storageUsed}
Last Backup: ${new Date(systemStatus.lastBackup).toLocaleString()}

PLATFORM DETAILS
========================
Version: 1.0.0
Architecture: Browser-based localStorage
Max Users: ~200 (localStorage limit)
Data Retention: Persistent until cleared
Authentication: Session-based
Encryption: None (demo mode)

PERFORMANCE METRICS
========================
Load Time: < 1s
Response Time: Instant (local)
Uptime: 100% (browser-based)
Memory Usage: Minimal
CPU Usage: < 1%`}</pre>
                            </div>
                        </div>

                        <div className="clockwork-card p-4 sm:p-6">
                            <h3 className="text-lg font-semibold mb-4 text-white">Maintenance Actions</h3>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <button onClick={exportDatabase} className="clockwork-button">
                                    📥 Export Database
                                </button>
                                
                                <button onClick={clearCache} className="clockwork-button-danger">
                                    🗑️ Clear Cache
                                </button>
                                
                                <button 
                                    onClick={() => {
                                        setSystemStatus(prev => ({
                                            ...prev,
                                            lastBackup: new Date().toISOString()
                                        }));
                                        setSuccessMessage('Backup completed successfully');
                                    }}
                                    className="clockwork-button-success"
                                >
                                    💾 Backup Now
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            if (!currentUser) {
                return <LoginForm />;
            }

            return (
                <div className="app-container">
                    <Navigation />
                    
                    {loading && (
                        <div className="loading-overlay">
                            <div className="loading-content">
                                <div className="loading-spinner"></div>
                                <p>Loading...</p>
                            </div>
                        </div>
                    )}
                    
                    {error && (
                        <div className="fixed top-4 right-4 z-50 animate-slide-in">
                            <div className="error-message">
                                {error}
                            </div>
                        </div>
                    )}
                    
                    {successMessage && (
                        <div className="fixed top-4 right-4 z-50 animate-slide-in">
                            <div className="success-message">
                                {successMessage}
                            </div>
                        </div>
                    )}
                    
                    <div className="container mx-auto px-4 py-6 main-content">
                        {activeTab === 'dashboard' && <Dashboard />}
                        {activeTab === 'measurements' && <Measurements />}
                        {activeTab === 'nutrition' && <Nutrition />}
                        {activeTab === 'workouts' && <Workouts />}
                        {activeTab === 'goals' && <Goals />}
                        {activeTab === 'chat' && <Chat />}
                        {activeTab === 'reports' && <Reports />}
                        {activeTab === 'billing' && <Billing />}
                        {activeTab === 'training' && <Training />}
                        {activeTab === 'users' && <Users />}
                        {activeTab === 'tests' && <Tests />}
                        {activeTab === 'engineer' && <EngineerConsole />}
                    </div>
                </div>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <ErrorBoundary>
                <App />
            </ErrorBoundary>
        );
    </script>
</body>
</html>